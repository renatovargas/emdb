[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MAFAP Emissions Database (EMDB)",
    "section": "",
    "text": "The Emissions Database (EMDB) initiative is an effort of the Monitoring and Analysing Food and Agricultural Policies (MAFAP) programme of the Agrifood Economics and Policy Division (ESA) of the Food and Agriculture Organization of the United Nations (FAO), which aims to provide a seamless integration of data on anthropogenic emissions of greenhouse gases and air pollution with National Accounts data at different levels of aggregation by economic activity for use with environmentally extended structural analysis frameworks like Computable General Equilibrium and Input-Output models. Its main output is the GEARS Database of anthropogenic emissions of greenhouse gases and air pollution by economic activity.\nIn addition to the database, EMDB also provides scripting facilities for the integration of different data sources, at different tiers of data availability by country and thorough documentation to abide by the principles of replicability, openness, and transparency.\nDisclaimer: While EMDB has been made possible with the support from the Food and Agriculture Organization of the United Nations (FAO), this is a work in progress, which has not undergone FAO’s rigorous review process and the methodological choices made here do not represent an institutional position of FAO, the Agrifood Economics and Policy Division (ESA), or any other of its instances. For more disclaimers, see the about page."
  },
  {
    "objectID": "documentation/guides/gears-user-guide.html",
    "href": "documentation/guides/gears-user-guide.html",
    "title": "GEARS User Guide",
    "section": "",
    "text": "This document explains the different elements of the GEARS database and how to best use this resource.",
    "crumbs": [
      "Documentation",
      "Guides",
      "GEARS User Guide"
    ]
  },
  {
    "objectID": "documentation/methods/querying_the_database.html",
    "href": "documentation/methods/querying_the_database.html",
    "title": "Querying the Database",
    "section": "",
    "text": "In this session, we query the database and tailor it to a particular SAM structure for Nigeria.\n\n\n\n# Clean workspace\nrm(list = ls())\n\n# Load libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(openxlsx)\n\n\n\n\n\n# Emissions long data\ntotal_emissions &lt;- readRDS(\"gears_db/data/outputs/gwp_total_emissions_long.rds\")\ntotal_emissions_pivot &lt;- readRDS(\"gears_db/data/outputs/gwp_total_emissions_pivot.rds\")\n\n# SAM Equivalence table\nsam_equivalence &lt;- read_xlsx(\n  \"gears_db/data/sam/nga/SAM-Nigeria-2018-Equivalence.xlsx\",\n  sheet = \"sam-equivalence\")\n\n# SAM elements\nsam_names &lt;- read_xlsx(\n  \"gears_db/data/sam/nga/SAM-Nigeria-2018.xlsx\",\n  range = \"B9:B224\",\n  sheet = \"SAM-names\",\n  col_names = F)\n\ncolnames(sam_names) &lt;- \"SAM Name\"\n\n# Add Undetermined to SAM elements\nundetermined_list &lt;- sam_equivalence[startsWith(sam_equivalence$`ISIC Detail`, \"9999\"), 1]\ncolnames(undetermined_list) &lt;- \"SAM Name\"\nsam_names &lt;- rbind(sam_names, undetermined_list)\n\n\n\n\nWe ask for an equivalence structure sam_equivalence in this case, between the ISIC Detail and the SAM. Through the use of R factors, we can make sure that the joined structure of the SAM is in the final product.\n\nnigeria_sam_emissions_2021 &lt;- total_emissions |&gt; \n  filter(\n    ISO3 == \"NGA\",\n    Year == 2018,\n    #Unit == \"kt\"\n  ) |&gt; \n  left_join(\n    sam_equivalence,\n    join_by(`ISIC Detail`)\n  ) |&gt; \n  mutate(\n    `SAM Name` = if_else(\n      is.na(`SAM Name`), \n      `ISIC Detail`,\n      `SAM Name`\n    )\n  ) |&gt;\n  mutate(\n    `SAM Name` = factor(\n      `SAM Name`,\n      levels = sam_names$`SAM Name`\n    )\n  ) |&gt; \n  pivot_wider(\n    id_cols = c(\n      Area,\n      ISO3,\n      Year,\n      `IPCC Code`,\n      IPCC,\n      # Category,\n      Driver,\n      `Emission Type`,\n      Unit\n    ),\n    names_from = c(`SAM Name`),\n    values_from = Value,\n    values_fn = sum,\n    names_expand = T\n  ) |&gt; \n  arrange(Unit) |&gt; \n  mutate(\n    Total = rowSums(across(where(is.numeric) & -3), na.rm = TRUE)\n  )\n\n# and save to file\n\nwrite.xlsx(\n  nigeria_sam_emissions_2021,\n  file = \"gears_db/data/outputs/emissions_nigeria_2018.xlsx\")\n\n\n\n\ntest_nigeria18 &lt;- total_emissions |&gt; \n  filter(Year == 2018,\n         Area ==\"Nigeria\")\ntest_nigeria18_pivot &lt;- total_emissions_pivot |&gt; \n  filter(Year == 2018,\n         Area ==\"Nigeria\")\nwrite.xlsx(\n  test_nigeria18,\n  file = \"gears_db/data/outputs/test_nigeria18.xlsx\")\nwrite.xlsx(\n  test_nigeria18_pivot,\n  file = \"gears_db/data/outputs/test_nigeria18_pivot.xlsx\")"
  },
  {
    "objectID": "documentation/methods/querying_the_database.html#libraries",
    "href": "documentation/methods/querying_the_database.html#libraries",
    "title": "Querying the Database",
    "section": "",
    "text": "# Clean workspace\nrm(list = ls())\n\n# Load libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(openxlsx)"
  },
  {
    "objectID": "documentation/methods/querying_the_database.html#datasets",
    "href": "documentation/methods/querying_the_database.html#datasets",
    "title": "Querying the Database",
    "section": "",
    "text": "# Emissions long data\ntotal_emissions &lt;- readRDS(\"gears_db/data/outputs/gwp_total_emissions_long.rds\")\ntotal_emissions_pivot &lt;- readRDS(\"gears_db/data/outputs/gwp_total_emissions_pivot.rds\")\n\n# SAM Equivalence table\nsam_equivalence &lt;- read_xlsx(\n  \"gears_db/data/sam/nga/SAM-Nigeria-2018-Equivalence.xlsx\",\n  sheet = \"sam-equivalence\")\n\n# SAM elements\nsam_names &lt;- read_xlsx(\n  \"gears_db/data/sam/nga/SAM-Nigeria-2018.xlsx\",\n  range = \"B9:B224\",\n  sheet = \"SAM-names\",\n  col_names = F)\n\ncolnames(sam_names) &lt;- \"SAM Name\"\n\n# Add Undetermined to SAM elements\nundetermined_list &lt;- sam_equivalence[startsWith(sam_equivalence$`ISIC Detail`, \"9999\"), 1]\ncolnames(undetermined_list) &lt;- \"SAM Name\"\nsam_names &lt;- rbind(sam_names, undetermined_list)"
  },
  {
    "objectID": "documentation/methods/querying_the_database.html#matching-to-sam-structure",
    "href": "documentation/methods/querying_the_database.html#matching-to-sam-structure",
    "title": "Querying the Database",
    "section": "",
    "text": "We ask for an equivalence structure sam_equivalence in this case, between the ISIC Detail and the SAM. Through the use of R factors, we can make sure that the joined structure of the SAM is in the final product.\n\nnigeria_sam_emissions_2021 &lt;- total_emissions |&gt; \n  filter(\n    ISO3 == \"NGA\",\n    Year == 2018,\n    #Unit == \"kt\"\n  ) |&gt; \n  left_join(\n    sam_equivalence,\n    join_by(`ISIC Detail`)\n  ) |&gt; \n  mutate(\n    `SAM Name` = if_else(\n      is.na(`SAM Name`), \n      `ISIC Detail`,\n      `SAM Name`\n    )\n  ) |&gt;\n  mutate(\n    `SAM Name` = factor(\n      `SAM Name`,\n      levels = sam_names$`SAM Name`\n    )\n  ) |&gt; \n  pivot_wider(\n    id_cols = c(\n      Area,\n      ISO3,\n      Year,\n      `IPCC Code`,\n      IPCC,\n      # Category,\n      Driver,\n      `Emission Type`,\n      Unit\n    ),\n    names_from = c(`SAM Name`),\n    values_from = Value,\n    values_fn = sum,\n    names_expand = T\n  ) |&gt; \n  arrange(Unit) |&gt; \n  mutate(\n    Total = rowSums(across(where(is.numeric) & -3), na.rm = TRUE)\n  )\n\n# and save to file\n\nwrite.xlsx(\n  nigeria_sam_emissions_2021,\n  file = \"gears_db/data/outputs/emissions_nigeria_2018.xlsx\")\n\n\n\n\ntest_nigeria18 &lt;- total_emissions |&gt; \n  filter(Year == 2018,\n         Area ==\"Nigeria\")\ntest_nigeria18_pivot &lt;- total_emissions_pivot |&gt; \n  filter(Year == 2018,\n         Area ==\"Nigeria\")\nwrite.xlsx(\n  test_nigeria18,\n  file = \"gears_db/data/outputs/test_nigeria18.xlsx\")\nwrite.xlsx(\n  test_nigeria18_pivot,\n  file = \"gears_db/data/outputs/test_nigeria18_pivot.xlsx\")"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "The Agrifood Economics and Policy Division (ESA) conducts economic research and policy analysis to support the transformation to more efficient, inclusive, resilient and sustainable agrifood systems for better production, better nutrition, a better environment, and a better life, leaving no one behind. ESA provides evidence-based support to national, regional and global policy processes and initiatives related to monitoring and analysing food and agricultural policies, agribusiness and value chain development, rural transformation and poverty, food security and nutrition information and analysis, resilience, bioeconomy, and climate-smart agriculture. The division also leads the production of two FAO flagship publications: The State of Food and Agriculture (SOFA) and The State of Food Security and Nutrition in the World (SOFI).\nWithin ESA, the Monitoring and Analysing Food and Agricultural Policies (MAFAP) programme seeks to establish country owned and sustainable systems to monitor, analyse, and reform food and agricultural policies to enable more effective, efficient and inclusive policy frameworks in 8 developing and emerging economies. MAFAP works with government institutions, research organizations and other partners to create sustainable policy monitoring systems and carry out a consistent set of policy and public expenditure analyses across a wide range of agricultural value chains. MAFAP analyses are used to inform targeted food and agricultural policy reforms that will result in a more conducive environment for agricultural investment and productivity growth, especially for smallholder farmers. As such, MAFAP supports most of FAO strategic objectives, and in particular those of enabling inclusive and efficient agricultural and food systems and helping eliminate hunger, food insecurity and malnutrition.\nA policy optimization modelling tool (that combines a recursive-dynamic computable general equilibrium model and multi-criteria decision-making techniques) is being used by the MAFAP programme team to develop and analyse scenarios where the public budget for the food and agriculture sector can be optimally re-allocated across different support measures (input subsidies, extension services, investments in different types of rural infrastructures, R&D, and so forth) and subsectors/commodities, aiming at improving on one or a combination of inclusive agricultural transformation (IAT) objectives such as: maximizing agrifood GDP, maximizing the number of off- farm jobs created in rural areas (vis-à-vis the number of on-farm jobs), and minimizing rural poverty. Most recently, the objective of minimizing the cost of the least-cost healthy diet was added to the tool. Next extensions to the tool comprise adding other objectives, notably the minimization of greenhouse gas (GHGs) emissions that are generated as a result of public expenditures in food and agriculture."
  },
  {
    "objectID": "about.html#general-information",
    "href": "about.html#general-information",
    "title": "About",
    "section": "",
    "text": "The Agrifood Economics and Policy Division (ESA) conducts economic research and policy analysis to support the transformation to more efficient, inclusive, resilient and sustainable agrifood systems for better production, better nutrition, a better environment, and a better life, leaving no one behind. ESA provides evidence-based support to national, regional and global policy processes and initiatives related to monitoring and analysing food and agricultural policies, agribusiness and value chain development, rural transformation and poverty, food security and nutrition information and analysis, resilience, bioeconomy, and climate-smart agriculture. The division also leads the production of two FAO flagship publications: The State of Food and Agriculture (SOFA) and The State of Food Security and Nutrition in the World (SOFI).\nWithin ESA, the Monitoring and Analysing Food and Agricultural Policies (MAFAP) programme seeks to establish country owned and sustainable systems to monitor, analyse, and reform food and agricultural policies to enable more effective, efficient and inclusive policy frameworks in 8 developing and emerging economies. MAFAP works with government institutions, research organizations and other partners to create sustainable policy monitoring systems and carry out a consistent set of policy and public expenditure analyses across a wide range of agricultural value chains. MAFAP analyses are used to inform targeted food and agricultural policy reforms that will result in a more conducive environment for agricultural investment and productivity growth, especially for smallholder farmers. As such, MAFAP supports most of FAO strategic objectives, and in particular those of enabling inclusive and efficient agricultural and food systems and helping eliminate hunger, food insecurity and malnutrition.\nA policy optimization modelling tool (that combines a recursive-dynamic computable general equilibrium model and multi-criteria decision-making techniques) is being used by the MAFAP programme team to develop and analyse scenarios where the public budget for the food and agriculture sector can be optimally re-allocated across different support measures (input subsidies, extension services, investments in different types of rural infrastructures, R&D, and so forth) and subsectors/commodities, aiming at improving on one or a combination of inclusive agricultural transformation (IAT) objectives such as: maximizing agrifood GDP, maximizing the number of off- farm jobs created in rural areas (vis-à-vis the number of on-farm jobs), and minimizing rural poverty. Most recently, the objective of minimizing the cost of the least-cost healthy diet was added to the tool. Next extensions to the tool comprise adding other objectives, notably the minimization of greenhouse gas (GHGs) emissions that are generated as a result of public expenditures in food and agriculture."
  },
  {
    "objectID": "about.html#disclaimer",
    "href": "about.html#disclaimer",
    "title": "About",
    "section": "Disclaimer",
    "text": "Disclaimer\nThe designations employed and the presentation of information on this website do not imply the expression of any opinion whatsoever on the part of FAO concerning the legal or development status of any country, territory, city or area or of its authorities, or concerning the delimitation of its frontiers or boundaries. The mention of specific companies or products of manufacturers, whether or not these have been patented, does not imply that these have been endorsed or recommended by FAO in preference to others of a similar nature that are not mentioned.\nInformation on this site is provided on an “as is” and “as available” basis. FAO makes every effort to ensure, but does not guarantee, the accuracy, completeness or authenticity of the information on this website. FAO reserves the right to alter, limit or discontinue any part of this service at its discretion. Under no circumstances shall FAO be liable for any loss, damage, liability or expense suffered that is claimed to result from the use of information posted on this site, including without limitation, any fault, error, omission, interruption or delay.\nHyperlinks to non-FAO websites do not imply any official endorsement of or responsibility on the part of FAO for the opinions, ideas, data or products presented at these locations, or guarantee the validity of the information provided. The sole purpose of links to non-FAO sites is to indicate further information available on related topics. The information is provided on the basis that users accessing the platform assume responsibility for assessing its relevance, accuracy and suitability for application.\nNo part of these Terms and Conditions shall constitute or be interpreted as a waiver of the privileges and immunities of FAO."
  },
  {
    "objectID": "sf/terra/NEWS.html",
    "href": "sf/terra/NEWS.html",
    "title": "version 1.8-21",
    "section": "",
    "text": "sieve failed with large rasters #1729 by Reed Humphrey\nextractRange only worked for SpatVector, not for matrix or vector #1733 by Victor Van der Meersch\nextract&lt;SpatRaster&gt; over https with a multilayer SpatRaster returned the values for the first layer for all layer #1736 by Shannon Albeke\n\n\n\n\n\nnew argument xyz=“” to the rast&lt;SpatVector&gt; method\nnew arguments “type” and “breaks” to plet&lt;SpatRaster&gt; method #1187 by Augustin Lobo\nnew argument “cores” in lapp&lt;SpatRasterDataset&gt; #1190 by kel44\naggregate&lt;SpatRaster&gt; now handles fun=\"table\" #1662 by Fernando Aramburu.\n\n\n\n\n\nis.flipped&lt;SpatRaster&gt; method #1627&gt;` by Timothée Giraud\nas.array&lt;SpatRasterDataset&gt; method\ndistance&lt;SpatRaster,missing&gt; now has argument “values”. If TRUE, the values of the nearest non-target cell is returned instead of the distance #1243 by Simon Dedman\nthresh&lt;SpatRaster&gt; #1233 by Agustin Lobo"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes",
    "href": "sf/terra/NEWS.html#bug-fixes",
    "title": "version 1.8-21",
    "section": "",
    "text": "sieve failed with large rasters #1729 by Reed Humphrey\nextractRange only worked for SpatVector, not for matrix or vector #1733 by Victor Van der Meersch\nextract&lt;SpatRaster&gt; over https with a multilayer SpatRaster returned the values for the first layer for all layer #1736 by Shannon Albeke"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements",
    "href": "sf/terra/NEWS.html#enhancements",
    "title": "version 1.8-21",
    "section": "",
    "text": "new argument xyz=“” to the rast&lt;SpatVector&gt; method\nnew arguments “type” and “breaks” to plet&lt;SpatRaster&gt; method #1187 by Augustin Lobo\nnew argument “cores” in lapp&lt;SpatRasterDataset&gt; #1190 by kel44\naggregate&lt;SpatRaster&gt; now handles fun=\"table\" #1662 by Fernando Aramburu."
  },
  {
    "objectID": "sf/terra/NEWS.html#new",
    "href": "sf/terra/NEWS.html#new",
    "title": "version 1.8-21",
    "section": "",
    "text": "is.flipped&lt;SpatRaster&gt; method #1627&gt;` by Timothée Giraud\nas.array&lt;SpatRasterDataset&gt; method\ndistance&lt;SpatRaster,missing&gt; now has argument “values”. If TRUE, the values of the nearest non-target cell is returned instead of the distance #1243 by Simon Dedman\nthresh&lt;SpatRaster&gt; #1233 by Agustin Lobo"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-1",
    "href": "sf/terra/NEWS.html#bug-fixes-1",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nreadRDS failed for rasters with timestep=“seconds” #1711 by Pascal Oettli\ndivide&lt;SpatVector&gt; always returned NULL #1724 by Márcia Barbosa\nerase failed in some cases #1710 by erkent-carb"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-1",
    "href": "sf/terra/NEWS.html#enhancements-1",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nbestMatch now has argument “fun” to allow the use of different distance measures, and a  method\nwrap (and writeRDS) now captures varnames/longnames #1719 by Andrew Gene Brown\nimproved raster metadata writing #1714 by Andrew Gene Brown\nvect and writeVector now properly read and write date and datetime data. #1718 by Andrew Gene Brown\nimproved estimate of available memory on linux systems #1506 by Cedric Rossi"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-2",
    "href": "sf/terra/NEWS.html#bug-fixes-2",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nexpanse&lt;SpatRaster&gt;(transform=TRUE) crashed R when the crs was “local”. #1671 by Michael Chirico\npatches(values=TRUE) wrapped around the edges #1675 by Michael Chirico\nspin now correctly handles spherical coordinates #1576 by jeanlobry\nmosaic sometimes crashed R #1524 by John Baums, Dave Klinges, and Hugh Graham.\nspatSample ignored argument “exp” when taking a random sample with na.rm=TRUE on a large raster #1437 by Babak Naimi\nsplit&lt;SpatVector,SpatVector&gt; did not work properly #1619 by Michael Sumner\nautocor improved handling of NA cells for global Moran computation #1992 by Nicholas Berryman\nshade is more memory-safe. #1452 by Francis van Oordt and Chris English\nfixed bug in rasterize revealed when using crop(mask=TRUE) #1686 by edixon1\nfixed to_id = NA bug in nearest #1471 by Mats Blomqvist\nbetter handling of date/unit #1684 and #1688 by Andrew Gene Brown\nspatSample(method=\"regular\") on a raster with one column returned too many samples #1362 by Daniel R Schlaepfer"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-2",
    "href": "sf/terra/NEWS.html#enhancements-2",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nplot&lt;SpatVector&gt; now uses the same default viridis color palette as plot&lt;SpatRaster&gt; #1670 by Márcia Barbosa\nrelate now accepts relation=“equals” #1672 by Krzysztof Dyba\ninit now accepts additional arguments for function “fun”\nbetter handling of the 32 connections limitation set by the HDF4 library #1481 by Dimitri Falk\nWhen using RStudio a once per session warning is given when using draw, sel or click #1063 by Sergei Kharchenko\ndistance&lt;SpatRaster&gt; from lon and lat lines/polygons computes distance to the edges instead of the nodes #1462 by Derek Friend\ndistance&lt;SpatVector,SpatVector&gt; now works for lon/lat data #1615 by Wencheng Lau-Medrano\nusing overviews for faster plotting of COGs over http #1353 by Michael Sumner and #1412; and argument plot(x, overview=) to change the default behavior.\nextract with points is now faster for rasters accessed over http #1504 by Krzysztof Dyba\nextract with many points on very large rasters was slower in compared to doing the same with “raster” (which uses terra for that!) #1584 by Hassan Masoomi\nmerge now has three alternative algorithms 1366 by Hassan Masoomi and #1650 by Agustin Lobo"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-1",
    "href": "sf/terra/NEWS.html#new-1",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\n$&lt;SpatRaster&gt; can now be used to get a categorical SpatRaster with a different active category\nscale_linear&lt;SpatRaster&gt; method for linear scaling of cell values between a minimum and maximum value such as 0 and 1\ndistance and related methods get argument “method” to choose the distance algorithm for lon/lat data #1677 by Márcia Barbosa\ndivide&lt;SpatRaster&gt; and divide&lt;SpatVector&gt; methods\nnseg counts the number of segments in a SpatVector #1647 by Michael Chirico\nextract argument “search_radius” to extract values from the nearest raster cell that is not NA #873 by matthewseanmarcus\ncombineLevels to combine the levels of all layers link on SO by Sam"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-3",
    "href": "sf/terra/NEWS.html#bug-fixes-3",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nspatSample(method='stratified', ext=e) returned the wrong sampling coordinates #1628 by Barnabas Harris\nspatSample(method='stratified') could fail with small sample sizes #1503 by karluf\ntransparency (alpha) did not work with RGB plotting. #1642 by Timothée Giraud\nrasterization failed on very large rasters #1636 by Mary Fisher, #1463 by Nic Spono and #1281 by Sebastian Dunnett\ntmpFiles only looked in the default temp files folder #1630 by smckenzie1986\nwhere.min did not work well if there were negative values #1634 by Michael Sumner\nplet&lt;SpatRaster&gt; now works for RGB rasters and rasters with a color table #1596 by Agustin Lobo\nvect&lt;MULTIPOINT WKT&gt; did not work properly #1376 by silasprincipe\ncompareGeom&lt;SpatVector&gt; did not work #1654 by Jason Flower\nbuffer&lt;SpatVector&gt; is now more accurate buffers for lonlat polygons #1616 by Roberto Amaral-Santos\nterra:interpNear used square windows, not circles, beyond 100 points #1509 by Jean-Luc Dupouey\nvect read INT64 fields as integers, sometimes leading to overflows. #1666 by bengannon-fc\nplot showed a legend title even if none was requested if title parameters were specified . #1664 by Márcia Barbosa"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-3",
    "href": "sf/terra/NEWS.html#enhancements-3",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nimproved documentation of writeVector overwrite when using layers. #1573 by Todd West\nimproved treatment of (supposedly) flipped rasters by Timothée Giraud #1627 and fchianucci #1646\nadded map.pal(\"random\") #1631 by Agustin Lobo\nexpressions can now be used in legend titles #1626 by Noah Goodkind\napp and tapp now emit a warning when factors are coerced to numeric #1566 by shuysman\nplet&lt;SpatRaster&gt; now has argument “stretch” for RGB rasters #1596 by Agustin\n%% and %/% now behave the same for SpatRaster as for (base R) numbers #1661 by Klaus Huebert"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-2",
    "href": "sf/terra/NEWS.html#new-2",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\npatches with option valus=TRUE can now distinguish regions based on their cell values (instead of only NA vs not-NA) #495 by Jakub Nowosad and #1632 by Agustin Lobo\nrowSums, rowMeans, colSums and colMeans for SpatRaster\nmetags for SpatRasterDataset #1624 by Andrea Manica\nmetags for layers (bands) of SpatRaster are now saved to and read from GTiff files #1071 by Mike Koontz\nglobal has new effcient functions “anyNA” and “anynotNA” #1540 by Kevin J Wolz\nwrap, saveRDS and serialize for SpatExtent. #1430 by BastienFR\nvect&lt;SpatGraticule&gt; method suggested in relation to tidyterra #155 by Diego Hernangómez\ntoMemory&lt;SpatRaster&gt; and &lt;SpatRasterDataset&gt; methods #1660 by Derek Friend"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-4",
    "href": "sf/terra/NEWS.html#bug-fixes-4",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nflip(direction=\"vertical\") failed in some cases #1518 by Ed Carnell\nzonal(as.raster=TRUE) failed when the zonal raster was categorical 1514 by Jessi L Brown\ndistance&lt;data.frame,data.frame&gt; and &lt;matrix,matrix&gt; ignored the unit argument. #1545 by Wencheng Lau-Medrano\nNetCDF files with month time-step encode from 0-11 made R crash #1544 by Martin Holdrege\nsplit&lt;SpatVector&gt; only worked well if the split field was of type character. #1530 by Igor Graczykowski\ngridDist (and probably some other methods) emitted a “cannot overwrite existing file” error when processing large datasets #1522 by Clare Pearson\nterrain did not accept multiple variables #1561 by Michael Mahoney\nrotate was vulnerable to an integer overflow #1562 by Sacha Ruzzante\ngetTileExtents could return overlapping tiles or tiles with gaps due to floating point imprecision. #1564 by Michael Sumner\nrasterize with points failed when using update=TRUE #1611 by Jordan Adamson\nbuffer on a lonlat multipoint SpatVector returned a buffer around a single point. #1607 by Márcia Barbosa\nbuffer&lt;SpatVector&gt; no longer crashes (for particular cases and unknown reasons) on windows #1331 by Julian090601, #1363 by Rupert Overall and #1531 by Igor Graczykowski"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-4",
    "href": "sf/terra/NEWS.html#enhancements-4",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nas.list&lt;SpatRasterDataset&gt; sets the names of the list #1513\na SpatVectorCollection can now be subset with its names; and if made from a list it takes the names from the list. 1515 by jedgroev\nargument fill_range to plot and plot&lt;SpatVector&gt; to use the color of the extreme values of the specified range #1553 by Mike Koontz\nplet&lt;SpatRaster&gt; can now handle rasters with a “local” (Cartesian) CRS. #1570 by Augustin Lobo.\ngeom can now return “wkb” #1609\nfaster plotting when color names are used. In response to question by Olle on gis.stackexchange.com"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-3",
    "href": "sf/terra/NEWS.html#new-3",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nmap_extent returns the coordinates of the axes position of a map created with plot&lt;Spat*&gt; #1517 by Daniel Schuch\npolys&lt;leaflet&gt; method #1543 by Márcia Barbosa\nplot&lt;SpatVectorCollection&gt; method #1532 by jedgroev\nadd_mtext to add text around the margins of a map. #1567 by Daniel Schuch"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-5",
    "href": "sf/terra/NEWS.html#bug-fixes-5",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nwriteVector and readVector better handle empty geopackage layers #1426 by Andrew Gene Brown.\nwriteCDF only wrote global variables if there was more than one #1443 by Daniel Schlaepfer\nrasterize with “by” returned odd layernames #1435 by Philippe Massicotte\nconvHull, minCircle and minRect with a zero-row SpatVector crashed R #1445 by Andrew Gene Brown\nrangeFill with argument circular=TRUE did not work properly #1460 by Alice\ncrs(describe = TRUE) returned an mis-ordered extent #1485 by Dimitri Falk\ntapp with a custom function and an index like “yearmonths” could shift time for not considering the time zone. #1483 by Finn Roberts\nplot&lt;SpatRaster&gt; could fail when there were multiple values with very small differences #1491 by srfall\nas.data.frame&lt;SpatRaster&gt; with “xy=TRUE” and “wide=FALSE” could fail if coordinates were very similar #1476 by Pascal Oettli\nrasterizeGeom now returns the correct layer name #1472 by HRodenhizer\ncellSize with “mask=TRUE” failed if the output was to be written to a temp file #1496 by Pascal Sauer\next&lt;SpatVectorProxy&gt; did not return the full extent #1501 by erkent-carb"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-5",
    "href": "sf/terra/NEWS.html#enhancements-5",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nextract has new argument “small=TRUE” to allow for strict use of “touches=FALSE” #1419 by Floris Vanderhaeghe.\nas.list&lt;SpatRaster&gt; has new argument “geom=NULL”\nrast&lt;list&gt; now recognizes (x, y, z) base R “image” structures stackoverflow by Ignacio Marzan.\ninset has new arguments “offset” and “add” #1422 by Armand-CT\nexpanse&lt;SpatRaster&gt; has argument usenames #1446 by Bappa Das\nthe default color palette is now terra::map.pal(\"viridis\") instead of terrain.colors. The default can be changes with options(terra.pal=...) #1474 by Derek Friend\nas.list&lt;SpatRasterDataset&gt; now returns a named list. #1513 by Eric R. Scott"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-4",
    "href": "sf/terra/NEWS.html#new-4",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nbestMatch&lt;SpatRaster&gt; method\nargument “pairs=TRUE” to cells #1487 by Floris Vanderhaeghe\nadd_grid to add a grid to a map"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-6",
    "href": "sf/terra/NEWS.html#bug-fixes-6",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nk_means did not work if there were NAs #1314 by Jakub Nowosad\nlayerCor with a custom function did not work anymore #1387 by Jakub Nowosad\nplet broke when using “panel=TRUE” #1384 by Elise Hellwig\nusing /vis3/ to open a SpatRaster did not work #1382 by Mike Koontz\nplot&lt;SpatRaster&gt;(add=TRUE) sampled the raster data without considering the extent of the map. #1394 by Márcia Barbosa\nplot&lt;SpatRaster&gt;(add=TRUE) now only considers the first layer of a multi-layer SpatRaster 1395 by Márcia Barbosa\nset.cats failed with a tibble was used instead of a data.frame #1406 by Mike Koontz\npolys argument “alpha” was ignored if a single color was used. #1413 by Derek Friend\nquery ignore the “vars” argument if all rows were selected. #1398 by erkent-carb.\nspatSample ignored “replace=TRUE” with random sampling, na.rm=TRUE, and a sample size larger than the non NA cells. #1411 by Babak Naimi\nspatSample sometimes returned fewer values than requested and available for lonlat rasters. #1396 by Márcia Barbosa."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-6",
    "href": "sf/terra/NEWS.html#enhancements-6",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nvect&lt;character&gt; now has argument “opts” for GDAL open options, e.g. to declare a file encoding. #1389 by Mats Blomqvist\nplot(plg=list(tic=\"\")) now allows choosing alternative continuous legend tic-mark styles (“in”, “out”, “through” or “none”)\nmakeTiles has new argument “buffer” #1408 by Joy Flowers."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-5",
    "href": "sf/terra/NEWS.html#new-5",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nprcomp&lt;SpatRaster&gt; method #1361 by Jakub Nowosad\nadd_box to add a box around the map. The box is drawn where the axes are, not around the plotting region.\ngetTileExtents provides the extents of tiles. These may be used in parallelization. See #1391 by Alex Ilich."
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-7",
    "href": "sf/terra/NEWS.html#bug-fixes-7",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nflip with argument direction=\"vertical\" filed in some cases with large rasters processed in chunks 0b714b0 by Dulci on stackoveflow\nSpatRaster now correctly handles NA & FALSE and NA | TRUE #1316 by John Baums\nset.names wasn’t working properly for SpatRasterDataset or SpatRasterCollection #1333 by Derek Friend\nextract with argument “layer” not NULL shifted the layers #1332 by Ewan Wakefield\nterraOptions did not capture “memmin” on stackoverflow by dww\nrasterize with points and a built-in function could crash if no field was used #1369 by anjelinejeline"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-7",
    "href": "sf/terra/NEWS.html#enhancements-7",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nmosaic can now use fun=\"modal\"\nrast&lt;matrix&gt; and rast&lt;data.frame&gt; now have option ’type=“xylz” #1318 by Agustin Lobo\nextract&lt;SpatRaster,SpatVector&gt; can now use multiple summarizing functions #1335 by Derek Friend\ndisagg and focal have more optimistic memory requirement estimation #1334 by Mikko Kuronen"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-6",
    "href": "sf/terra/NEWS.html#new-6",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nk_means&lt;SpatRaster&gt; method #1314 by Agustin Lobo\nprincomp&lt;SpatRaster&gt; method #1361 by Alex Ilich\nhas.time&lt;SpatRaster&gt; method\nnew argument “raw=FALSE” to rast, sds, and sprc to allow ignoring scale and offset 1354 by Insang Song"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-8",
    "href": "sf/terra/NEWS.html#bug-fixes-8",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nmosaic ignored the filename argument if the SpatRasterCollection only had a single SpatRaster #1267 by Michael Mahoney\nAttempting to use extract with a raster file that had been deleted crashed R. #1268 by Derek Friend\nsplit&lt;SpatVector,SpatVector&gt; did not work well in all cases. #1256 by Derek Corcoran Barrios\nintersect with two SpatVectors crashed R if there was a date/time variable #1273 by Dave Dixon\n“values=FALSE” was ignored by spatSample&lt;SpatRaster&gt;(method=\"weights\") #1275 by François Rousseu\ncoltab&lt;- again works with a list as value #1280 by Diego Hernangómez\nstretch with histogram equalization was not memory-safe #1305 by Evan Hersh\nplot now resets the “mar” parameter #1297 by Márcia Barbosa\nplotRGB ignored the “smooth” argument #1307 by Timothée Giraud"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-8",
    "href": "sf/terra/NEWS.html#enhancements-8",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nargument “gdal” in project was renamed to “use_gdal” #1269 by Stuart Brown.\nSpatVector attributes can now be stored as an ordered factor #1277 by Ben Notkin\nplot&lt;SpatVector&gt; now uses an “interval” legend when breaks are supplied #1303 by Gonzalo Rizzo\ncrop&lt;SpatRaster&gt; now keeps more metadata, including variable names #1302 by rhgof\nextract(fun=\"table\") now returns an easier to use data.frame #1294 by Fernando Aramburu."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-7",
    "href": "sf/terra/NEWS.html#new-7",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nmetags&lt;- and metags to set arbitrary SpatRaster/file level metadata #1304 by Francesco Chianucci"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-9",
    "href": "sf/terra/NEWS.html#bug-fixes-9",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nplot&lt;SpatVector&gt; used the wrong main label in some cases #1210 by Márcia Barbosa\nplotRGB failed with an “ext=” argument #1228 by Dave Edge\nrast&lt;array&gt; failed badly when the array had less than three dimensions. #1254 by andreimirt.\nall.equal for a SpatRaster with multiple layers #1236 by Sarah Endicott\nzonal(wide=FALSE) could give wrong results if the zonal SpatRaster had “layer” as layername. #1251 by Jeff Hanson\npanel now support argument “range” #141 by Jakub Nowosad\nrasterize with by= returned wrong layernames if the by field was not sorted #1266 by Sebastian Dunnett\nmosaic with multiple layers was not correct #1262 by Jean-Romain"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-9",
    "href": "sf/terra/NEWS.html#enhancements-9",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nwrap&lt;SpatRaster&gt; now stores color tables #1215 by Patrick Brown\nglobal now has a “maxcell” argument #1213 by Alex Ilich\nlayerCor with fun=‘pearson’ now returns output with the layer names #1206\nvrt now has argument “set_names” #1244 by sam-a-levy\nvrt now has argument “return_filename” #1258 by Krzysztof Dyba\nproject&lt;SpatRaster&gt; has new argument “by_util” exposing the GDAL warp utility #1222 by Michael Sumner."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-8",
    "href": "sf/terra/NEWS.html#new-8",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\ncompareGeom for list and SpatRasterCollection #1207 by Sarah Endicott\nis.rotated&lt;SpatRaster&gt; method #1229 by Andy Lyons\nforceCCW&lt;SpatVector&gt; method to force counter-clockwise orientation of polygons #1249 by srfall.\nvrt_tiles returns the filenames of the tiles in a vrt file #1261 by Derek Friend\nextractAlong to extract raster cell values for a line that are ordered along the line. #1257 by adamkc."
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-10",
    "href": "sf/terra/NEWS.html#bug-fixes-10",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nthe tempdir option did not use path.expand. #1195 by Alex Ilich\nthe layer names returned by predict where inconsistent when using argument “index”. #1194 by Michael Mahoney\ncompilation failed with older compilers because of use of std::filesystem #1191\nSmall changes to RGB&lt;- and coltab&lt;- so that terra can be installed with R-devel (after a bug fix https://bugs.r-project.org/show_bug.cgi?id=18538)"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-11",
    "href": "sf/terra/NEWS.html#bug-fixes-11",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nrasterize with points and a custom function did not work for large rasters. #1127 by Skip Woolley\ncrop&lt;SpatRaster, SpatVector&gt; with “mask=TRUE” did not work well if the raster had a scale/offset #1128 by Monika Anna Tomaszewska\nzonal&lt;SpatRaster&gt; with a custom function always removed NAs. #1133 by Matthias Weigand\nwrap&lt;SpatRaster&gt; lost changed layer names if the source was from disk; and information on some time-step in some cases. #1144 by Pascal Führlich\nglobal(fun=\"isNA\") was not correct when the SpatRaster had multiple layers #1141 by Robin Freeman\ninterpIDW with near=TRUE did not work properly (near=TRUE is now the default). #1186 by Hugh Graham\n“YYYY-1-1” was sometimes encoded as “YYYY-13-1”. #1168 by Colin Brust"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-10",
    "href": "sf/terra/NEWS.html#enhancements-10",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\npanel for categorical SpatRasters. #1143 by Jason Flower\nargument “ext” in plot&lt;SpatRaster&gt; can now also expand the plot. #1136 by Jakub Nowosad.\nargument overwrite=FALSE to makeTiles. #1167 by Gray Martin.\nlegend options for &lt;plet,SpatVector&gt;. #1177 by Agustin Lobo.\nbetter handling of mixed geometry type vector data by vect and svc. #1160 by Mike Sumner.\nnew argument sql to query&lt;SpatVectorProxy&gt;. #1157 by Carl Boettiger\nsupport for writing raster data to a vitual file system #1209 by Carl Boettiger"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-9",
    "href": "sf/terra/NEWS.html#new-9",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nwrap&lt;SpatRasterDataset&gt; and wrap&lt;SpatRasterCollection&gt; methods. #954 by James Camac"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-10",
    "href": "sf/terra/NEWS.html#new-10",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nregress&lt;SpatRaster,numeric&gt; to get regression model coefficients for each cell, with a fixed “X”.\nregress&lt;SpatRaster,SpatRaster&gt; to get regression model coefficients for each cell."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-11",
    "href": "sf/terra/NEWS.html#enhancements-11",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nlapp&lt;SpatRasterDataset&gt; is now more flexible in that it can now also use functions that are vectorized by cell, not by chunk. See #1029\nproject&lt;SpatVector&gt; has new argument “partial=FALSE” that can be used to keep geometries that can only be partially included in the output crs.\nextracting a SpatVector column with a non-existing variable name now returns NULL (because that is what a data.frame does) instead of throwing an error. #1118 by Derek Friend."
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-12",
    "href": "sf/terra/NEWS.html#bug-fixes-12",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\na problem with reading empty categories in .img files created buggy SpatRasters\nglobal with fun=“notNA” was wrong #111 by Jeffrey Hanson\nextract&lt;SpatRaster,SpatVector&gt; with “bind=TRUE” did not work\nextract&lt;SpatRaster,SpatVector&gt; with point geometries and a “fun” returned values in the wrong order\nplot&lt;SpatRaster&gt; argument “colNA” did not work when “alpha” was also set #1102 by Márcia Barbosa\ncrop&lt;SpatRaster&gt; with “extend=TRUE” did not extend the SpatRaster if the input had no cell values. #1114 by Jasper van Doninck\nsetting a factor or date/time variable in a SpatVector did not work #1117 by MK Schneider\nfocalMat did not work well when using terraOptions(todisk=T) #1116"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-11",
    "href": "sf/terra/NEWS.html#new-11",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nThe halo function for adding halo-ed text to plots is now exposed\nadd_legend to allow using a keyword such as “topleft” to position a custom legend. #1053 by Márcia Barbosa\nthe same.crs function is now exported\ncountNA&lt;SpatRaster&gt; method\nsplit&lt;SpatVector,SpatVector&gt; to split polygons with lines"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-12",
    "href": "sf/terra/NEWS.html#enhancements-12",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nbetter support for other color spaces than RGB #1060 by Dominic Royé\npath expansion in writeVector #1055 by Andrew Gene Brown.\nclamp&lt;SpatRaster&gt; now also accepts SpatRasters to set the lower and upper boundaries.\nfreq has new arguments “zones=NULL” and “wide=FALSE”, to allow tabulation of values by zone.\nexpanse&lt;SpatRaster&gt; has new arguments “zones=NULL” and “wide=FALSE”, to allow tabulation of values by zone.\nunique&lt;SpatRaster&gt; has new argument “digits=NA”\nrasterize&lt;SpatRaster,SpatVector&gt; now accepts fun=“table” to tabulate cells by cell value\nrast&lt;character&gt; has new argument “snap” to snap the window in or out. #1094 by Derek Friend\nplot has new argument “clip=TRUE” that can be set to FALSE to avoid clipping the axes to the mapped area #1080 by Márcia Barbosa\nbetter error message when coercing an sf object that is not fully formed #1098 by Brandon McNellis\nwriteCDF&lt;SpatRaster&gt; had new argument “split” allowing to treat each layer as a subdataset #1077 by Andrea Manica\nglobal now accepts multiple summarizing functions"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-13",
    "href": "sf/terra/NEWS.html#bug-fixes-13",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nA SpatRaster with RGB layers was forced to INT1U when writing #1051 by Cesar Aybar\nIn files with multiple vector layers, the crs of the first layer was always used; ignoring that the crs could be different for other layers #1052 by Andrew Gene Brown\nsieve was not able to write to file #1061 by leo\nrasterize did not work with sf objects #1054 by Jakub Nowosad\nquery did not work for hyphenated layer names #1058 by Robbie Price\nfocal3D na.policy did not work #1057 by Flávio Mota\nlayerCor with na.rm=TRUE failed for a SpatRaster with more than 2 layers #1056 by Alex Ilich.\ninset with keyword positioning did not work well #1053 by Márcia Barbosa\nyearmonths time stamps were not read from file for years &lt;1970 and &gt;2037 #1062 by Colin Brust\ncompareGeom did not work for multiple SpatRasters #1063\nviewshed could not handle a filename argument. #1100 by kamistick"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-12",
    "href": "sf/terra/NEWS.html#new-12",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nargument order=FALSE to sort&lt;SpatRaster&gt;\nsort&lt;SpatVector&gt; (and &lt;data.frame&gt; method\nargument by=NULL to rasterize&gt; #986 by Sam Weber\nmeta&lt;SpatRaster&gt; method to get metadata\ncompare&lt;SpatRaster&gt; and logic&lt;SpatRaster&gt; methods\nvect&lt;SpatExtent&gt; method\npanel&lt;SpatRaster&gt; for “panel” plots (multiple layers, single legend)"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-13",
    "href": "sf/terra/NEWS.html#enhancements-13",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nit is now possible to save terra options across sessions #995 by Guillaume Patoine.\nbetter warnings for is.lonlat #1006 by Andrew Gene Brown\nargument na.rm to merge&lt;SpatRaster&gt;\nthe axes of maps created with plot are now snug around the mapped area, instead of at the limits of the graphics figure region.\nC++ cleaning to avoid warnings by clang-tidy (e.g. now using .empty() instead of .size()==0). [#1013-1017] by Michael Chirico\nrasterize with lines and polygons can now use the “fun” argument (for min, max, mean, and sum) #1041 by Bart Huntley"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-14",
    "href": "sf/terra/NEWS.html#bug-fixes-14",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nthe legend created by plet was not always correct. #983 by Simon Rolph\nspatSample&lt;SpatRaster&gt;(regular=TRUE) failed with providing two numbers (row, col) as sample size. #991 by srfall\nmerge&lt;SpatRaster&gt; did not ignore NAs #1002 by jmmonnet.\nwriteCDF failed when using argument force_v4 #1009 by R. Kyle Bocinsky\npredict better handling of rasters with many NAs #988 by Lucas Johnson\nlayerCor did not handle NAs well if they were in different cells across layers #1034 by François Rousseu."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-13",
    "href": "sf/terra/NEWS.html#new-13",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nargument w to zonal&lt;SpatRaster,SpatRaster&gt; to compute weighted means\nzonal&lt;SpatRaster,SpatVector&gt; method\nclamp_ts method"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-15",
    "href": "sf/terra/NEWS.html#bug-fixes-15",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nin the previous version, a bug was introduced such that the order of operation in arithmetic operations with SpatRasters was ignored. #978 by Andrew Marx\nFixed split&lt;SpatVector&gt;. #979 by srfall\nspatSample with as.df=FALSE returned a data.frame instead of a matrix #982 by Alex Ilich"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-14",
    "href": "sf/terra/NEWS.html#new-14",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\narithmetic and logical operations between a SpatRaster and a matrix, to allow for using cell-varying and cell/layer-varying scalars. layer-varying scalars were already supported via vectors."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-14",
    "href": "sf/terra/NEWS.html#enhancements-14",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nshade is now vectorized for arguments angle and direction to facilitate generating multiple hillshades that can be combined for a better result #948 by Jürgen Niedballa\nsharedPaths now uses spatial indices #960 by Jeff Hanson\npredict has better support for models such as ranger that do not return anything for missing values #968 by Alex Ilich"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-16",
    "href": "sf/terra/NEWS.html#bug-fixes-16",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nwriteCDF now supports writing yearly time steps #926 by Andrea Manica\nas.contour now works for a single level #966 by Johannes Signer\nsubsetting a SpatRaster with a window returned a SpatRaster with the dimensions of the non-windowed raster, thus changing the resolution. #964 by Derek Friend\nremoving a factor variable from a SpatVector crashed R. #969 by Andrew Gene Brown\nmedian did not always return the correct number for a SpatRaster with 3 or more layers #970 by MatteaE"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-15",
    "href": "sf/terra/NEWS.html#new-15",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nroll&lt;SpatRaster&gt; method for rolling (moving) average and other rolling functions\nnoNA&lt;SpatRaster&gt; method to identify cells that are not NA (across layers)\nrangeFill&lt;SpatRaster&gt; method"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-15",
    "href": "sf/terra/NEWS.html#enhancements-15",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nargument exhaustive to spatSample&lt;SpatRaster&gt; for large sparse rasters. [#905] by PetiteTong.\nfocalPairs and focalReg can now use the values in custom windows as weights. [#907] by Fabian Fischer.\nfocalReg now has additional argument “intercept=TRUE”. [#916] by Jordan Adamson\ncrs(x, warn=TRUE)&lt;- now emits a warning about the difference between transforming and setting a crs when x already had a crs. [#897] by Márcia Barbosa.\nit is now possible to write a scale and offset with writeRaster [#900] by Kyle David\ncrosstab now shows the labels names for a categorical SpatRaster. [895] by Derek Corcoran Barrios\nmakeTiles can now take a SpatVector to define the tiles. [920] by Tristan Goodbody"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-17",
    "href": "sf/terra/NEWS.html#bug-fixes-17",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nfocalPairs and focalReg now work for custom windows [#907] by Fabian Fischer\nargument “alpha” in plot&lt;SpatVector&gt; was not working properly. [#906] by Márcia Barbosa.\ntime&lt;- with time-step “years” could not handle negative years. [#911] by Andrea Manica\nwrap/unwrap (and by extension saveRDS/readRDS) did not handle categorical rasters well [#912] by Christine Anderson.\ninterpIDW failed with GDAL 3.6 [#910] by Roger Bivand\nspatSample with strata bug fix “unable to find an inherited method for function ‘trim’” [#919] by Alfredo Ascanio\nit is possible to slice a SpatRaster with a SpatExtent [#914] by Jakub Nowosad.\nmerge/mosaic did not handle NAs when using two layers [#913] by Joao Carreiras."
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes",
    "href": "sf/terra/NEWS.html#name-changes",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\n\nfocalCor -&gt; focalPairs to reflect its possible use beyond correlation"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-16",
    "href": "sf/terra/NEWS.html#new-16",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\n[ and [&lt;- for SpatRaster now have a third index k for subsetting or assigning values by layer\nanyNA and allNA for SpatRaster\nunwrap to restore a PackedSpatVector or PackedSpatRaster\nrasterizeWin method for rasterization with a moving window (circle, ellipse, rectangle, buffer)\ninterpIDW method for inverse-distance-weighted interpolation of points with a moving window\ninterpNear method for nearest neighbor interpolation of points with a moving window\nviewshed method for SpatRaster\nupdate method for SpatRaster to write new names or a new extent or crs to an existing raster file.\nsieve filter for SpatRaster\nargument segments=FALSE to disagg&lt;SpatRaster&gt;\nsprc&lt;character&gt; method to create a SpatRasterCollection from a file with subdatasets\ngraticule function to create a SpatGraticule and related methods plot&lt;SpatGraticule&gt; and crop&lt;SpatGraticule&gt;\nelongate method for SpatVector lines"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-16",
    "href": "sf/terra/NEWS.html#enhancements-16",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nfaster mosaic and merge&lt;SpatRaster&gt; [#577] by Jean-Romain\nwrap&lt;SpatRaster&gt; now uses file references if the data is deemed too large to all load into memory. [#801] by Jean-Romain\nreadRDS and unserialize now return a SpatRaster or SpatVector (instead of a PackedSpat*)\nbetter support for a “local” arbitrary Euclidean crs [#797] by Agustin Lobo\nclamp can now take low and high values for each layer\nThe pax argument in plot now provides more control over what to draw on each axis via parameters side, tick and lab\nThe pax argument in plot now has argument retro to use a sexagesimal notation of degrees\nextend has a new argument fill=NA\nA warning is now given when combining SpatRasters with different CRSs. [#818] by Andrew Marx\nplotRGB now accounts for the value of zlim when stretching; allowing to use the same coloring scheme across SpatRasters [#810] by Agustin Lobo.\nthe center of rotation for spin is now vectorized"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-18",
    "href": "sf/terra/NEWS.html#bug-fixes-18",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nThe annoying garbage collection messages Error in x$.self$finalize() : attempt to apply non-function is now suppressed in most cases. [#218] by Charlie Joey Hadley. This problem should go away altogether when a new version of “Rcpp” is released (ETA Jan 2023) thanks to a fix by Kevin Ushey [#30]\nspatSample with na.rm and SpatRasters with multiple layers did not work. [#800] by Andrea Manica\nadjacent&lt;SpatRaster&gt; with pairs=TRUE, include=TRUE ignored include=TRUE [#808] by Joseph Lewis\nrasterize did not accept “NA” as value for updating [#809] by Márcia Barbosa\nextract with a perfectly vertical or horizontal line failed in some cases [#823] by Dimitri Falk\nwrap&lt;SpatVector&gt; failed if there was a single point geometry [#815] by Patrick Schaefer\nextract&lt;SpatRaster&gt; with weights=TRUE did not return values [#814] by Jean-Luc Dupouey.\nx[[\"newname\"]] &lt;- r for SpatRasters x and r did not work [#795] by Jim Shady\nfixed support for some non-conventional netCDF files [#869] by Mike Sumner, [#864] by eleanorecc, and [#851] by Philippe Massicotte."
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes-1",
    "href": "sf/terra/NEWS.html#name-changes-1",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\n\ncostDistance -&gt; costDist to avoid conflict with {gdistance}\ngridDistance -&gt; gridDist for consistency"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-17",
    "href": "sf/terra/NEWS.html#new-17",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\ndroplevels for SpatRaster. [#757] by Rodolfo Jaffe.\nnormalize.longitude for SpatVector.\nscoff to get and scoff&lt;- to set the scale (gain) and offset of a SpatRaster."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-17",
    "href": "sf/terra/NEWS.html#enhancements-17",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nnew argument raw=FALSE to extract&lt;SpatRaster&gt; [#776] by Thomas Roh.\nas.data.frame now takes na.rm=NA to only remove rows that are NA for all layers. The default value changed from TRUE to NA. [#792] by Ed Carnell\nfaster plotting of SpatVector data [#774] by Krzysztof Dyba\ndistance&lt;SpatRaster&gt; has new arguments “target” and “exclude”. [#560] by Bernardo Brandão Niebuhr\nnew argument sparse=FALSE for `relate&lt;SpatVector,SpatVector&gt;.\nnew argument usenames=FALSE for lapp&lt;SpatRasterDataset&gt; [#793] by Colin Brust.\nvect&lt;character&gt; now reports that a file is non-existent [#784] by John Baums\nfaster relate [#716] by Krzysztof Dyba\nfocal3D now checks if all the window’s dimensions are odd [#772] by Neander Marcel Heming"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-19",
    "href": "sf/terra/NEWS.html#bug-fixes-19",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nall.equal bug [#756] fixed by John Baums\nextract&lt;\"SpatRaster\",\"sf\"&gt; ignored the ID argument. [#755] by Dainius Masiliūnas.\nThere is now (in all cases) a check to avoid overwriting (one of) the input file(s) when writing a raster file [#760] by John Baums\nvrt is no longer constrained by the maximum number of files that can be opened [#780] by 8Ginette8\n\nweighted.mean crashed with numeric weights and na.rm=TRUE [#777] by David Holstius\nproject&lt;SpatRaster&gt; did not consider an extent that was set by the user [#775] by Philippe Massicotte\nfocalCor failed for large rasters [#607] by John Clark\nfocal with expand=TRUE was prone to run out of memory [#610] by Nathan Elliott\ncrop&lt;SpatVector&gt; did not work well when the second argument were points or lines [#782] by Márcia Barbosa\nadjacent with pairs=TRUE now respects the include=TRUE argument [808] by Joseph Lewis"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-18",
    "href": "sf/terra/NEWS.html#new-18",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nmethod blocks to guide reading raster data in chunks. [#748] by John Baums"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-18",
    "href": "sf/terra/NEWS.html#enhancements-18",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nA warning is given when writing raster values that are outside the limits of the requested datatype [#752] by Jim Shady\nArguments to extract were simplified. [#736] by François Rousseu"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-20",
    "href": "sf/terra/NEWS.html#bug-fixes-20",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nvalues of focal where not correct if the input SpatRaster had multiple layers and a “custom” function. [#727] by Jean-Luc Dupouey.\nplot&lt;SpatRaster&gt; did not honor argument legend=FALSE. [#738] by Grzegorz Sapijaszko\nexpanse failed when processing in chunks [#741] by Gareth Davies\ncrop&lt;SpatRaster,SpatExtent&gt; with argument snap=\"out\" could lead to a crash if the extent was beyond the SpatRaster. [#740] by Mauricio Zambrano-Bigiarini"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-21",
    "href": "sf/terra/NEWS.html#bug-fixes-21",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nsubst no longer uses values that it changed earlier on. [#639] by Paul Smith\nas.points&lt;SpatRaster&gt; could return wrong factor labels. [#640] by Attilio Benini\nmask&lt;SpatRaster,SpatVector&gt; crashed when the results were written to disk. [#646] by Monika Anna Tomaszewska\nextract&lt;SpatRaster,SpatVector(points)&gt;(xy=TRUE) returned the locations of the points, not the xy-coordinates of the cells. [#650] by Ward Fonteyn\nwrap&lt;SpatRaster&gt; did not return the correct labels for some categorical rasters. [#652] by Jakub Nowosad\nbetter support for non-latin characters in the legend [#658] by Krzysztof Dyba\nholes in small lon/lat polygons are now properly buffered [#689] by David Hofmann"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-19",
    "href": "sf/terra/NEWS.html#enhancements-19",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nsubst can now substitute the values from multiple input layers with a single output value (layer)\nsubset&lt;SpatVector&gt; now behaves like subset&lt;data.frame&gt; [#648] by Andrew Gene Brown\nsetting category labels with a vector of names is now deprecated. A data.frame with at least two columns should be used. The first column should have the cell values (IDs).\nIt is now possible to “drop” a layer from a SpatRaster by setting it to NULL [#664] by Daniel Valentins\nfreq now provides the labels of factors, even if bylayer=FALSE. It now always returns a data.frame (it used to return a matrix in some cases. [#687] by Rodolfo Jaffé\ndisagg and aggregate now return a warning instead of an error when using a (dis)aggregation factor of 1.[#684] by Justin Fain.\nproject crashed when erroneously projecting raster data from one celestial body to another [#688] by Mike Sumner\nyou can now set a color table with a two column (value, ID) data.frame\ncategorical rasters can now be updated more easily [#667] by Alex Ilich\nmore control over matching values with colors when using plot. [#673] by Jakub Nowosad.\nSpatVector attributes can now also be a factor, date, or POSIXct. [#697] by Grant Williamson\nimproved handling of missing values in extract(method=\"bilinear\"). [#693] by swooping-magpie"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-19",
    "href": "sf/terra/NEWS.html#new-19",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nargument as.raster to unique&lt;SpatRaster&gt; to create a categorical raster with the unique combinations in the layers of the input raster. The default for argument na.rm was changed to FALSE\nsort&lt;SpatRaster&gt; to sort cell values across layers.\nhas.colors and has.RGB for SpatRaster\ncover can now combine categorical rasters\nconcats to combine the levels of two SpatRaster into new categories [#663] by Alex Ilich\nzonal&lt;SpatVector,SpatVector&gt; method to aggregate SpatVector attributes by polygons"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-22",
    "href": "sf/terra/NEWS.html#bug-fixes-22",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\n“flipped” rasters were not always handled well. [#546] by Dan Baston\nbetter reading of GTiff with subdatsets. [#601] by Kyle Doherty\nbetter handling of multi-layer categorical rasters and extract. [#580] by André M. Bellvé\nweighted.mean did not adjust the weights if there were NAs in the values. [#574] by Lars Dalby\nbug in masking. [#552] reported by Márcia Barbosa and [565] by Jakub Nowosad.\nfixed stretch option in plotRGB [#550] by Agustin Lobo\nunwrap of a SpatRaster failed with a crs including a “’”. [#602] by Jean Romain.\nspatSample with cells=TRUE failed for planar data [#544] by Benjamin Misiuk\ncompareGeom(x, y, stopOnError=FALSE) did not remove the error messages stored in x leading to unexpected warnings later on. [#568] by David Hofmann."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-20",
    "href": "sf/terra/NEWS.html#enhancements-20",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nUsing & or | with SpatRasters now returns a boolean SpatRaster. [#594] by Dan Baston\nSpatVector now supports logical values. [#593] by Derek Friend\nAttempt to create SpatRaster with an invalid number of rows now gives an error. [#544] by Dan Baston\nlayerCor does not create temp files anymore. [#551] by Christine Anderson\nnot using the same iterator symbols in nested loops to avoid warnings on the Intel compiler. [#573] by Gareth Davies."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-20",
    "href": "sf/terra/NEWS.html#new-20",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nnew arguments res and origin to project&lt;SpatRaster&gt; method. [#596] by Alex Ilich\nnew argument inside=TRUE to centroids to get a centroid-like point that is guaranteed to be on the geometry (“point on surface”). [#588] by Márcia Barbosa\nnew argument keepgeom=FALSE to vect&lt;data.frame&gt; that allows setting (keeping) the geometry as an attribute. [#586] by Márcia Barbosa\nsaveRDS and serialize methods for SpatRaster and SpatVector. [#549] by Andrei Mîrț\nxFromCol and yFromCol now have a &lt;SpatRaster,missing&gt; method. [#583] by Michael Sumner.\nsvc&lt;sf&gt; method to deal with GeometryCollection types. [#585] by Sarah Endicott\nas.points&lt;SpatRaster&gt; and as.polygons&lt;SpatRaster&gt; have a new argument na.all=FALSE that affects the interpretation of na.rm. [#548] by Jean-Luc Dupouey.\nsetGDALconfig and getGDALconfig to set GDAL configuration options. [#608] by Erik Bolch.\nnew argument circular to rapp to allow the start to be after the end (for if layers represent days of the year)\nnew method costDistance&lt;SpatRaster&gt;\nnew methods where.min and where.max for SpatRaster to get the cell numbers for the extreme values in a SpatRaster.\nnew method emptyGeoms&lt;SpatVector&gt; to get the indices of empty (null) geometries\nnew method rasterizeGeom to rasterize the geometry count or the area of (small) polygons or the length of lines.\nnew method not.na for SpatRaster which is a shortcut for !is.na(x).\nas.list implemented for &lt;SpatRasterDataset&gt;.\nsources implemented for &lt;SpatRasterDataset&gt;, &lt;SpatVector&gt; and &lt;SpatVectorProxy&gt; [#638] by Andrew Gene Brown"
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes-2",
    "href": "sf/terra/NEWS.html#name-changes-2",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\n\ndelauny -&gt; delaunay [#627] by Derek Friend"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-21",
    "href": "sf/terra/NEWS.html#enhancements-21",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nmakeTiles has new arguments extend and na.rm [#520] by by L. Dalby\nproject&lt;SpatRaster&gt; now uses nearest neighbor as default method for RGB rasters\nnew argument na.rm=TRUE to unique. [#561] by Matthieu Stigler"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-23",
    "href": "sf/terra/NEWS.html#bug-fixes-23",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\napp&lt;SpatRasterDataset&gt; ignored the filename. [#498] by jszhao\nvect&lt;data.frame&gt; failed silently if xy coordinates were integers [#496] by Márcia Barbosa\nThe output of aggregate&lt;SpatRaster&gt; was malformed when nrow(x) %% fact != 0. [#492] by Jean-François Bourdon\nInteger NAs in SpatVector attributes where only recognized on Windows [#491] by Márcia Barbosa\nplot&lt;SpatVector&gt; failed when using a character variable with many unique values. [#489] by Márcia Barbosa\nrotate failed on large files. Reported by Ujjawal Singh\nwriting raster files with a color table could lead to a crash [#501] by Kodi Arfer\ncrds replicated the coordinates [#504] by Murray Efford\nas.data.frame&lt;SpatRaster&gt; returned integers if the file stored values as integers, even if there was a scale/offset that creates decimal numbers [#509] by Kodi Arfer\nproject opened the input raster file in read/write mode instead of read mode. That did not work with files that cannot be updated."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-22",
    "href": "sf/terra/NEWS.html#enhancements-22",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\ndistance, gridDistance, direction and patches now process all layers of the input SpatRaster. [#503] by Chris Haak\nconsistent copy-on-modify behavior in ()&lt;- methods. in-place updating available with set. methods such as set.names and set.values. [#493] by Jean Romain and [#511] by Bryan Fuentes\nmuch faster writing of GPGK vector data by using a single transaction (following sf) [#460] by Krzysztof Dyba\naggregate&lt;SpatRaster&gt; now accepts functions that return more than one value per aggregated cell\nwriteVector has new argument insert to add a layer to an existing file (e.g. GPKG)."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-21",
    "href": "sf/terra/NEWS.html#new-21",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nnew option method=\"weights\" for spatSample&lt;SpatRaster&gt;\nnew mask&lt;SpatVector,SpatVector&gt; method to select intersecting geometries\nnew method is.related\nvalues&lt;SpatRaster&gt; has new option na.rm=TRUE. [#490] by Henk Harmsen\nnew class SpatVectorProxy to provide access to large vector databases that cannot or should not be read into memory in its entirety.\nnew argument proxy=FALSE to vect to create a SpatVectorProxy object\nnew method query&lt;SpatVectorProxy&gt; to extract parts of a SpatVectorProxy\nnew method vector_layers that returns, and can delete, vector format layers from a database/file such as GPKG"
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes-3",
    "href": "sf/terra/NEWS.html#name-changes-3",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\nTo avoid name clashes with tidyverse\n\narrow -&gt; north\nsrc -&gt; sprc\nsimplify -&gt; simplifyGeom\n\nFor consistency\n\nsetCats -&gt; set.cats"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-24",
    "href": "sf/terra/NEWS.html#bug-fixes-24",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nsetValues and init failed (or even crashed R) when using a single value on a largish raster. [#414]\nconversion from sfc to SpatVector lost the crs. [#415] by Jean-Luc Dupouey\nbuffer on a SpatRaster with no values caused a crash [#416] by Sebastian Brinkmann\nwriteVector now assumes “traditional GIS order” (long/lat) if the CRS specifies lat/long. [#333]( by Agustin Lobo\nargument main was ignored in density when using a single layer SpatRaster [#424] by dvictori\nSummary type math functions such as min and mean, when used with multiple SpatRasters and numbers, ignored additional SpatRasters [#426] by Zhuonan Wang\nnames are now conserved when creating a SpatRaster from a RasterStack that points to file(s) [#430] by Dan Baston\nclassify with right=FALSE ignored include.lowest=TRUE [#442] by Alex Ilich\npatches now combines patches that connect across the data line [#366] by Hirscht\npatches(directions=8) now connects in NE/SW direction [#451] by Jean-François Bourdon.\ncentroids now considers cases where SpatVector parts are nearest to each other when crossing the date line instead of the zero-meridian [#366] by Hirscht\nterrain created empty (NA) rows between chunks used for processing large rasters. [#453] by Robert Ritson.\ninset did not draw the “box” correctly. [#457] by Márcia Barbosa\nas.lines now works with a points SpatVector [#464] by Márcia Barbosa"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-23",
    "href": "sf/terra/NEWS.html#enhancements-23",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nvalues(x)&lt;- now accepts (hex coded) colors as values\nfocal now wraps around the dateline like raster::focal [#242] by Alexander Marbler\naggregate now does not show a progress bar in all cases [#249] by Lachlan\nas.data.frame&lt;SpatRaster&gt; or &lt;SpatVector&gt; are now also implemented as S3 methods to assure correct dispatch by other S3 methods such as data.table::as.data.table. See [#284] by Patrick Schratz\ncrs now shows the correct authority if it is not EPSG. [#419] by Matthew Williamson\nIt now possible to add a SpatRaster to an empty SpatRaster (with no values), even if it has a different geometry, ignoring the empty SpatRaster [#421] by Alex Ilich.\nrast&lt;filename&gt; has a new argument lyrs to subset the layers and open the file in one step.\nrast&lt;array&gt; now has a crs and extent argument. [#439] by RS-eco\ntype=\"xyz\" is now default in rast&lt;data.frame&gt;. [#438] by RS-eco\nclassify has a new argument brackets to show if a side of an interval is open or closed.\nfurther support for categorical data in freq and as.data.frame. [#441] ngould7\nspeed up in processing of multi-layer in memory data. [#437] by Krzysztof Dyba\nvect&lt;matrix&gt; and vect&lt;data.frame&gt; are now much faster. [#413] by BastienFR\n\nextract with points provided as a matrix or cell numbers is not much faster. [#341]\nfocal has a new argument na.policy that can be set to one of “all” (default), “only” or “omit”. argument na.only has been removed, as you can now use na.policy=\"only\"\ninset argument border changed to perimeter to allow passing border on to plot&lt;Spat*&gt;. [#456] by Márcia Barbosa\nThe compile-time and run-time versions of GEOS are now compared and a warning is given if they are not the same. [#459] by Edzer Pebesma\nit is now possible to add sub-datasets to GPKG and GTiff files. [#300] by gtitov\ngeneral option memfrac can now be set to zero (in stead of not lower than 0.1). [#476] by Matt Strimas-Mackey\nnew argument allowGaps in patches to disallow gaps between patch IDs. See [#478] by Dunbar Carpenter."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-22",
    "href": "sf/terra/NEWS.html#new-22",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\ntimestamps and units are now saved to an auxiliary file (filename.aux.json) for all raster formats except NetCDF when using writeCDF (because in that case they are stored in the netcdf file)\nnew method mergeTime to combine multiple rasters, perhaps partly overlapping in time, into a single time series\nnew method fillTime that can add empty layers in between existing layers to assure that the time step between layers is constant\nnew method approximate to fill in missing values by cell across layers\nnew methods is.bool and as.bool for SpatRaster and explicit recognition of Boolean raster data in various places (e.g., extract, plot)\nnew methods is.int and as.int for SpatRaster.\nwhen assigning integer values to a SpatRaster, or when reading an integer file, the corresponding layers are now classified as being of integer type [#446] by L. Dalby\nnew method layerCor (like raster::layerStats). [#420] by Alex Ilich\nnew method focalCor (like raster::corLocal). [#427] by Zhuonan Wang\nnew method all.equal for SpatRaster. See [#428] by Dongdong Kong\nnew method math for SpatRaster that implements the Math-generic methods and accepts a filename\nnew method sds&lt;array&gt;\nnew method rasterize&lt;matrix&gt;, see [#413] by BastienFR\n\nnew method colorize to transform color representations\n\nnew method arrow to draw a (North) arrow on a map. [#461] by Márcia Barbosa\nnew method densify to insert nodes between existing nodes of a line or polygon SpatVector\nnew method direction for SpatRaster. [#462] by Márcia Barbosa\nnew method focal3D to compute focal values for a three-dimensional (row, column, layer) window\nnew function makeVRT to create a vrt file for a file that needs a header to be read.\nnew option method=\"stratified\" for spatSample&lt;SpatRaster&gt;. [#470] by Michael Mahoney\nnew general option memmax to cap the amount of RAM that terra can be used in raster processing [#476] by Matt Strimas-Mackey\nnew method gridDistance to compute distances traversing a raster, perhaps with obstacles. [#477] by Márcia Barbosa"
  },
  {
    "objectID": "sf/terra/NEWS.html#changes",
    "href": "sf/terra/NEWS.html#changes",
    "title": "version 1.8-21",
    "section": "changes",
    "text": "changes\n\nfocal now has ellipses (...) to allow for providing additional arguments to fun. For this reason it does not have a na.rm argument anymore as that can be supplied via the ellipses. In practice this means that the default will be na.rm=FALSE for the standard functions such as mean and sum."
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-25",
    "href": "sf/terra/NEWS.html#bug-fixes-25",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\napp grossly overestimated RAM needed, slowing it down. Reported by Jerry Nelson\nterra now installs, again, with older versions of GEOS [#406] by fparyani\nterra did not install with Clang on CRAN/OSX due to using C++13 idiom."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-24",
    "href": "sf/terra/NEWS.html#enhancements-24",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nlapp and tapp now have a cores argument (as do app and predict). Suggested by Dongdong Kong [#365]\nfocal now also works with a function that returns multiple values. See [#318] by Alex Ilich.\nfocal can now process multiple layers in one step.\nexpanded support for conversion from stars objects [#220] by Jakub Nowosad"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-23",
    "href": "sf/terra/NEWS.html#new-23",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nfocalCpp takes a C++ function that iterates over cells to speed up computation by avoiding apply (see [#318] by Alex Ilich).\nfocalReg for focal OLS regression models between layers"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-26",
    "href": "sf/terra/NEWS.html#bug-fixes-26",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nterra did not install with versions of GDAL below 3 [#402] by Alex Ilich.\ndistance between two SpatVectors or matrices with pairwise=FALSE returned a matrix that was filled by column instead of by row [#403] by Paul Smith"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-27",
    "href": "sf/terra/NEWS.html#bug-fixes-27",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nrast with some NetCDF files failed because of bad parsing of dates. [#361] by Juan Carlos Zamora-Pereira\ndistance&lt;SpatRaster&gt; with lon/lat data was not correct. [#368] by Greg Schmidt\nas.polygons&lt;SpatRaster&gt; failed with a SpatRaster and a categorical layer that is not the first layer. [#370] by Patrick Schratz\nThe filename argument in rasterize was not ignored, also causing errors when writing to temporary files. [#377] by Robbie Price\nrast&lt;character&gt; crashed if the sds was an empty character string. [#381] by Dan Baston\nplot&lt;SpatVector&gt; now responds to the range argument [#385] by Márcia Barbosa\nzonal failed for user-defined functions. [#393] by mqueinnec"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-24",
    "href": "sf/terra/NEWS.html#new-24",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nnew method selectHighest to select n cell values with the highest or lowest values.\nnew method vect&lt;list&gt; to append SpatVectors (faster than do.call(rbind, x))\nnew argument align=FALSE to project to align to the template SpatRaster but ignore the resolution\nnew method gdalCache to set the GDAL cache size, contributed by Dan Baston [#387]\nnew method fileBlocksize\nnew argument options to writeVector to pass layer creation options to GDAL\nnew SpatVector topology methods mergeLines, snap, makeNodes, removeDupNodes, gaps, simplify\nnew SpatVector characterization methods width and clearance"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-25",
    "href": "sf/terra/NEWS.html#enhancements-25",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nterra now installs with older versions of GEOS [#363]\nterra now installs on CentOS 7 with GDAL 2.1.4 and a C++ compiler that does not support std::regexp. [#384] by Ariel Paulson"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-26",
    "href": "sf/terra/NEWS.html#enhancements-26",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nthe definition of setValues now has two arguments (x and values), just like raster had; to avoid reverse dependency problems with raster"
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes-4",
    "href": "sf/terra/NEWS.html#name-changes-4",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\nTo avoid name conflicts with sp (via raster) disaggregate is now called disagg and bbox,SpatRaster and bbox&lt;SpatVector&gt; have been removed (but could be resurrected in raster or under another name)."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-27",
    "href": "sf/terra/NEWS.html#enhancements-27",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nproject and resample now choose the resampling method based on the first layer, using “near” for categorical data. Thanks to Matthew Lewis [#355]"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-28",
    "href": "sf/terra/NEWS.html#bug-fixes-28",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nhist failed with small samples. Issue [#356] by Martin Queinnec"
  },
  {
    "objectID": "sf/terra/NEWS.html#note",
    "href": "sf/terra/NEWS.html#note",
    "title": "version 1.8-21",
    "section": "note",
    "text": "note\nterra no longer depends on raster. To avoid name clashes between these two packages, and to allow replacing methods from rgeos and rgdal in raster, raster now depends on terra instead."
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-28",
    "href": "sf/terra/NEWS.html#enhancements-28",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nfreq has a new argument usenames. See issue [#309] by Bappa Das\nrast&lt;character&gt; has a new argument opts that can be used to pass GDAL open options. See issue [#314]\nrast&lt;SpatRaster&gt; now takes arguments names and vals. See issue [#323] by Dongdong Kong\ncrs&lt;- now warns if an unsupported datum is used. See issue [#317]\nspatSample now returns factor values if a SpatRaster layer is.factor except when using as.df=FALSE\nnew method origin&lt;- to set the origin of a SpatRaster. See issue [#326] by Jakub Nowosad\ncrs has a new argument parse. See [#344]\nplot&lt;SpatRaster,missing&gt; has a new argument reset=FALSE that allows resetting the par()$mar parameters after plotting. See issue [#340] by Derek Friend\ncrds has a new argument na.rm. See [#338] by Kodi Arfer\nshow(Spat*) now prints the name and EPSG code of a crs if available. See [#317] by Jakub Nowosad"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-29",
    "href": "sf/terra/NEWS.html#bug-fixes-29",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nplotRGB failed if there were NAs. Issue [#308] by Jakub Nowosad\nwriteVector crashed R when used with a SpatVector with no geometries. Reported by Timothy White in issue [#319]\nsummary&lt;SpatRaster&gt; now returns counts for the classes (instead of a numerical summary of the indices) [#324] by Jakub Nowosad\ntapp with a character index now returns a SpatRaster with the correct names [#345] by Stuart Brown\nrasterize with a character variable now adds the ID column to the categories [#337] by Tate Brasel\ncellSize now masks values in all cases (when requested with mask=TRUE). Issue [#339] by Jean-Luc Dupouey\nbuffer&lt;SpatVector&gt; no longer treats lines like polygons [#332] by Márcia Barbosa\nplot now passes the layer index to fun [#310] by Ben Tupper\nthe to_id in nearest was sometimes wrong. See [#328] by Shawn Ligocki\nbetter support for ESRI value attribute tables (VAT). See this SO question\nfocal did not reset initial values for NA cells when processing chunks. [#312] by Jeffrey Evans\nfocal could run out of memory when using a large window and user-defined function, and was inexact at the chunk boundary [#347]\nzonal with as.raster=TRUE failed for categorical SpatRasters [#348] by Jakub Nowosad"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-29",
    "href": "sf/terra/NEWS.html#enhancements-29",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nif time(x) &lt;- d is set with a Date class object, time(x) now returns a Date object instead of a POSIXct object. Issue [#256] by Mauricio Zambrano-Bigiarini\nThe UTF-8 encoding of character attributes of a SpatVector is now declared such that they display correctly in R. See issue [#258] by AGeographer. Also implemented for names in both SpatVector and SpatRaster\nrast&lt;data.frame&gt; method to avoid confusion with the matrix and list methods in response to a SO question by Stackbeans\nthe extreme values used to represent NA where not as intended (one or two lower) for INT2U and INT4U. Reported by Jean-Luc Dupouey on stackoverflow\nwriteCDF now also writes the time dimensions if there is only one time-step. See this SO question\nvect&lt;character&gt; (filename) now has argument layer to select a layer from a multi-layer file / database, and arguments query, extent and filter for reading a subset\nsubst can now create multiple output layers See [issue 276] by Agustin Lobo\nclassify can now create different multiple output layers See [issue 276] by Agustin Lobo\nArgument alpha of plot&lt;SpatRaster&gt; can now be a SpatRaster. See this SO question by James McCarthy"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-30",
    "href": "sf/terra/NEWS.html#bug-fixes-30",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nThe filename and overwrite arguments were ignored in rasterize\ngdal options are now also honored for create-copy drivers [#260]\nbuffer for lonlat now works better at the world’s “edges” [#261]\nscale/offset were ignored by project. Reported by Fabian Fischer\nrasterize&lt;SpatRaster,SpatVector&gt; with inverse=TRUE crashed the R session. Issue [#264] by Jean-Luc Dupouey\nThe output of merge and mosaic was not correct for large rasters (only the first rows were used). Reported by Zavud Baghirov in [#271]\nas.points,SpatRaster did not remove NA’s correctly and shifted values. Issues [#269] and [#273] by Julian Hagenauer\nrast&lt;matrix&gt; rotated values when using an equal-sided matrix [#274] by Jakub Nowosad\nthe number of rows and columns were reversed when using project with a crs argument. [#283] by Timothée Giraud\nIn classify, argument right had TRUE and FALSE reversed.\nterrain had edge effects [#303] by Andrew Gene Brown.\nterrain can now compute multiple variables at once [#286] by Žan Kuralt\nwrap&lt;SpatRaster&gt; changed factors into numeric [#302] by Patrick Schratz\nwriteVector failed with “FlatGeobuf” (and probably other formats as well) for not using a proper MultiPolygon [#299] by L Dalby\nregular sampling of polygons with spatSample is now much more regular [#289] by Jakub Nowosad"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-25",
    "href": "sf/terra/NEWS.html#new-25",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nna.omit&lt;SpatVector&gt; to remove empty geometries and/or attribute records that have an NA\nnew method src to create a SpatRasterCollection (a loose collection of tiles).\nmerge and mosaic now have methods for a SpatRasterCollection. To avoid the (inefficient) use of do.call. #210 by Matthew Talluto.\nactiveCat and activeCat&lt;- to get or set the “active” category if there are multiple categories (raster attributes)\nas.numeric and catalyze to transfer categories to numeric cell values\nsummarize methods such as range and mean for (the attributes of) a SpatVector\nnew method shade, to compute hill shading"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-30",
    "href": "sf/terra/NEWS.html#enhancements-30",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nadditional arguments (such as na.rm) are now used by rasterize with point geometries. #209 by Jakub Nowosad\nimproved handling (and documentation) of gstat models by interpolate. #208 by Jakub Nowosad\nnew argument cpkgs to predict to list the packages that need to be exported to the cores if argument cores is larger than one. ?predict now shows different approaches to parallelize predict (based on examples in issue. #178 by by Matthew Coghill.\nfreq now returns labels for categorical layers\nadjacent now has a pairs argument. #239 by Kenneth Blake Vernon\nadjacent now also takes a matrix to specify adjacent cells\nmean and other summarize methods now take a filename argument and disallow non-recognized named arguments. #238 by Jessica Nephin\nThe raster attribute table of ESRI-GRID integer data, or from an ESRI vat.dbf file is now ignored if it only has the counts of the values. #234 by Jullee\ntime attributes are no longer lost when doing raster operations. #246 by Mauricio Zambrano-Bigiarini\nresample (and project) no longer ignore gdal=\"\" write options and use BIGTIFF if necessary (suggested by Ani Ghosh)\nnew argument layer in the extract-SpatRaster,SpatVector method to extract values for a single layers specified for each geometry (see this question)."
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-31",
    "href": "sf/terra/NEWS.html#bug-fixes-31",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nbetter handling of paths with non-ASCII characters (e.g., Chinese) for GeoTiff but still fails for NetCDF. [#233] by Dongdong Kong\nextract with points and cells=TRUE or xy=TRUE gave garbled output\nas.character&lt;SpatRaster&gt; (called by wrap) did not capture the layer names. [#213] by Pascal Title\nfocal mirrored the weight matrix, thus affecting the results when using an asymmetrical weight matrix. Reported by Sebastiano Trevisani\nterra::terraOptions now works without attaching the package. [#229] by Karl Dunkle Werner\napp with ncores &gt; 0 and a function that returns multiple layers now works. [#240] by BastienFR.\nautocor (local) can now handle NA values. [#245] by Jakub Nowosad .\nmask with a SpatVector and a large (out of memory) multi-layer SpatRaster only worked for the first layer. Reported by Monika Tomaszewska."
  },
  {
    "objectID": "sf/terra/NEWS.html#new-26",
    "href": "sf/terra/NEWS.html#new-26",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\nas.lines method for SpatRaster\nas.polygons method for SpatVector lines\nautocor&lt;numeric&gt; has new methods mean, to compute the local mean, and locmor, for the local Moran’s I\nsharedPaths method for SpatVector (lines and polygons)\nRGB2col method to reduce a three-layer RGB SpatRaster to a single layer SpatRaster with a color-table (with &lt;= 256 colors)\nsplit methods for SpatVector and SpatRaster"
  },
  {
    "objectID": "sf/terra/NEWS.html#enhancements-31",
    "href": "sf/terra/NEWS.html#enhancements-31",
    "title": "version 1.8-21",
    "section": "enhancements",
    "text": "enhancements\n\nrast&lt;Raster*&gt; now takes the crs from the Raster object, not from the file it may point to. [#200] by Floris Vanderhaeghe\nconvhull has a new argument by=\"\" to make convex hulls for sub-sets of a SpatVector.\nfaster processing of large in memory rasters. See issue [#206] by Krzysztof Dyba."
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-32",
    "href": "sf/terra/NEWS.html#bug-fixes-32",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nextract with multiple layers could return a data.frame where the values were not in the correct order (by row instead of by column)\ncrop works again with sf objects. [#201] by Sebastian Brinkmann\nvect&lt;sf&gt; now also works for lines, and should be faster\nvect&lt;character&gt; crashed R if a file had empty geometries. [#202] by consumere\nextract(points, bilinear=TRUE, cells=TRUE) now works. [#203] by fab4app\nzonal now works for min and max. [#207] Reported by Jakub Nowosad"
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes-5",
    "href": "sf/terra/NEWS.html#name-changes-5",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\nTo avoid name conflicts with the spatstat package\n\narea,SpatRaster-method(x, sum=FALSE) -&gt; cellSize(x)\narea,SpatRaster/SpatVector-method(x, sum=TRUE) -&gt; expanse(x)\nconvexhull -&gt; convHull\nperimeter -&gt; perim\ntiles -&gt; makeTiles\ncoords -&gt; crds"
  },
  {
    "objectID": "sf/terra/NEWS.html#new-27",
    "href": "sf/terra/NEWS.html#new-27",
    "title": "version 1.8-21",
    "section": "new",
    "text": "new\n\ntrim has a new argument value that allows trimming rows and columns with other values than the default NA\nrapp has a new argument clamp that allows clamping start and end values to 1:nlyr(x), avoiding that all values are considered NA\nspatSample&lt;SpatRaster&gt; has new arguments as.points and values. Getting values, cells and coordinates is no longer mutually exclusive. In response to [#191] by Agustin Lobo\narea&lt;SpatRaster&gt; has a new argument mask=FALSE\nclassify can now take a single number to request that many cuts\nmosaic and merge now warn and resample if rasters are not aligned\nextract has a new argument exact to get the fraction covered for each cell"
  },
  {
    "objectID": "sf/terra/NEWS.html#bug-fixes-33",
    "href": "sf/terra/NEWS.html#bug-fixes-33",
    "title": "version 1.8-21",
    "section": "bug fixes",
    "text": "bug fixes\n\nflip(x, direction=\"vertical\") no longer reverses the order of the layers\nextract did not work for horizontal or vertical lines as their extent was considered invalid. Reported by Monika Tomaszewska\nautocor did not handle NA values [#192] by Laurence Hawker\nnearest now works for angular coordinates\nThe unit of slope in terrain was not correct (the tangent was returned instead of the slope), [#196] by Sven Alder\nquantile now works for rasters that have cells that are all NA. Reported by Jerry Nelson"
  },
  {
    "objectID": "sf/terra/NEWS.html#name-changes-6",
    "href": "sf/terra/NEWS.html#name-changes-6",
    "title": "version 1.8-21",
    "section": "name changes",
    "text": "name changes\nTo avoid name conflicts with tidyverse\nwith deprecation warning:\n\nseparate -&gt; segregate\nexpand -&gt; extend\nnear -&gt; nearby\npack -&gt; wrap\n\nwithout deprecation warning:\n\ntranspose -&gt; trans\ncollapse -&gt; tighten\nfill -&gt; fillHoles\nselect -&gt; sel"
  },
  {
    "objectID": "sf/terra/NEWS.html#major-changes",
    "href": "sf/terra/NEWS.html#major-changes",
    "title": "version 1.8-21",
    "section": "major changes",
    "text": "major changes\n\nc&lt;SpatVector&gt; now returns a list. rbind is used to append SpatVector objects\noverhaul of handling of factors. rats has been removed, and levels and cats have changed"
  },
  {
    "objectID": "download.html",
    "href": "download.html",
    "title": "Data Downloads",
    "section": "",
    "text": "Here you can download different versions of the MAFAP Emissions Database. Please refer to the MAFAP EMDB guide for details."
  },
  {
    "objectID": "download.html#complete-database",
    "href": "download.html#complete-database",
    "title": "Data Downloads",
    "section": "Complete Database",
    "text": "Complete Database\nWe provide annual time series data on emissions of the three main greenhouse gases (CO2, CH4, N2O) and fluorinated gases per sector, country, and driver where possible, expressed in CO2 teq for a 100-year horizon (AR5), in zipped Comma Separated Values (“.csv”) files, as well as much smaller R dataset files (“.rds”) for convenience.\n\n\n\n\n\n\n\n\nGWP Total Emissions ISIC Pivot provides a wide dataset with ISIC sectors and agriculture subsectors as columns.\n Download .csv \n Download .rds \n\n\nGWP Total Emissions ISIC Long provides a long version with sectors and agriculture subsectors concatenated into a single column.\n Download .csv \n Download .rds \n\n\nGWP Total Emissions provides all decriptor fields in disaggregated form for maximum flexibility.\n Download .csv \n Download .rds"
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html",
    "href": "documentation/methods/emissions_db_construction.html",
    "title": "MAFAP Emissions Database Construction",
    "section": "",
    "text": "The Monitoring and Analyzing Food and Agricultural Policies (MAFAP) program seeks to establish country owned and sustainable systems to monitor, analyze, and reform food and agricultural policies to enable more effective, efficient and inclusive policy frameworks. Since policies are only enacted when they are properly funded, MAFAP tools are particularly geared towards helping countries—the agricultural public sector, in particular—optimize public budgets in the face of competing objectives, like economic growth, poverty reduction, better nutrition, or increasing yields, for example.\nIn the face of increasing vulnerability, climate risk mitigation and adaptation objectives have also become a part of the policy dialogue, as different international commitments (e.g. the Paris Agreement) present new demands and challenges to governments. To be able to provide objective functions within MAFAP tools, it has become necessary to extend its socioeconomic reach to include environmental objectives. As an extension of the MAFAP CGE modelling tool, the Global Emissions Database aims to provide a seamless integration of data on anthropogenic emissions of greenhouse gases and air pollution with structural analysis frameworks like Computable General Equilibrium and Input-Output models.\nHere we describe the approach used to construct an anthropogenic emissions accounting satellite framework by economic activity and driver, using globally available datasets. We aim to maintain compatibility with the System of National Accounts (SNA) with which economic performance is measured (European Commission et al. 2009). Where possible, we adopt approaches suggested by previous efforts at harmonization between Greenhouse Gas Inventories and SEEA pilot implementations (Eurostat 2015; Flachenecker, Guidetti, and Pionnier 2018; Gutman et al. 2024).\nEmissions from combustion are estimated at the economic activity level using the International Industrial Standard Classification—ISIC—(United Nations 2008) and driver, using the Tier 1 method of the Intergovernmental Panel on Climate Change—IPCC—(IPCC 1996, 2006) and energy use information from the Energy Statistics Database (UNSD 2023). Emissions from Industrial Processes and Waste come from EDGAR (Crippa et al. 2023) and are mapped to economic activities following a broadly tested global approach that facilitates use with CGE frameworks; i.e. that of the Global Trade Analysis Project—GTAP—(Aguiar et al. 2019; Chepeliev 2024). Emissions from Agriculture are sourced from FAOSTAT (FAO 2024) and mapped to ISIC economic activities. Individual drivers are left for the practitioner to map to their own structure (i.e. output by industries, endowment by industries, input use by industries, and consumption by households).",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#overview",
    "href": "documentation/methods/emissions_db_construction.html#overview",
    "title": "MAFAP Emissions Database Construction",
    "section": "Overview",
    "text": "Overview\nAs our goal is to leverage valuable emissions data from different sources, we have scripted data processing routines to ingest original datasets in tabular format (mainly Excel Files and Comma Separated Values) and manipulate them to conform to a single flat file structure, using the R programming language (R Core Team 2024)1. The original datasets, translated into the much smaller size RDS binary format, as well as the processing scripts, are included with the resulting emissions database repository2. The flow of data follows the diagram in Figure 1.\n\n\n\nMAFAP Complementary Emissions Database Construction Process\n\n\nFigure 1",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#total-emissions-from-edgar",
    "href": "documentation/methods/emissions_db_construction.html#total-emissions-from-edgar",
    "title": "MAFAP Emissions Database Construction",
    "section": "Total Emissions from EDGAR",
    "text": "Total Emissions from EDGAR\nWe start our methodological discussion with the sourcing of The Emissions Database for Global Atmospheric Research—EDGAR—(Crippa et al., 2023) datasets published by the European Commission because they are comprehensive, covering most of the greenhouse gas emissions inventories domains as shown in Table 1, belonging to 1) energy; 2) Industrial processes and product use; 3) Agriculture, forestry, and other land use; 4) Waste; and 5) Other (mainly indirect emissions from deposition of Nitrogen). This allows us to provide an overview of the coverage needed by our dataset. However, due to the form in which the data is presented in the EDGAR data and our database needs, we only take advantage of emissions data on industrial processes, waste, and “other” (which refers mainly to emissions from the atmospheric deposition of nitrogen). To avoid double counting, we replace emissions from the use of energy (Chapter 1A) with data from the UN Energy Database (UNSD 2023) and emissions from agriculture, forestry, and other land use with data from FAOSTAT (FAO 2024). For comparison purposes, it is important to note that large scale biomass burning with Savannah burning, forest fires, and sources and sinks from land-use, land-use change and forestry (LULUCF) are not covered in EDGAR, but are in FAOSTAT.\n\n\n\nTable 1: EDGAR greenhouse gas inventory domain coverage\n\n\n\n\n\n\n\n\n\nCode\nIPCC Greenhouse Gas Inventory domain\n\n\n\n\n1.A.1.a\nMain Activity Electricity and Heat Production\n\n\n1.A.1.bc\nPetroleum Refining - Manufacture of Solid Fuels and Other Energy Industries\n\n\n1.A.2\nManufacturing Industries and Construction\n\n\n1.A.3.a\nCivil Aviation\n\n\n1.A.3.b_noRES\nRoad Transportation no resuspension\n\n\n1.A.3.c\nRailways\n\n\n1.A.3.d\nWater-borne Navigation\n\n\n1.A.3.e\nOther Transportation\n\n\n1.A.4\nResidential and other sectors\n\n\n1.A.5\nNon-Specified\n\n\n1.B.1\nSolid Fuels\n\n\n1.B.2\nOil and Natural Gas\n\n\n2.A.1\nCement production\n\n\n2.A.2\nLime production\n\n\n2.A.3\nGlass Production\n\n\n2.A.4\nOther Process Uses of Carbonates\n\n\n2.B\nChemical Industry\n\n\n2.C\nMetal Industry\n\n\n2.D\nNon-Energy Products from Fuels and Solvent Use\n\n\n2.E\nElectronics Industry\n\n\n2.F\nProduct Uses as Substitutes for Ozone Depleting Substances\n\n\n2.G\nOther Product Manufacture and Use\n\n\n3.A.1\nEnteric Fermentation\n\n\n3.A.2\nManure Management\n\n\n3.C.1\nEmissions from biomass burning\n\n\n3.C.2\nLiming\n\n\n3.C.3\nUrea application\n\n\n3.C.4\nDirect N2O Emissions from managed soils\n\n\n3.C.5\nIndirect N2O Emissions from managed soils\n\n\n3.C.6\nIndirect N2O Emissions from manure management\n\n\n3.C.7\nRice cultivations\n\n\n4.A\nSolid Waste Disposal\n\n\n4.B\nBiological Treatment of Solid Waste\n\n\n4.C\nIncineration and Open Burning of Waste\n\n\n4.D\nWastewater Treatment and Discharge\n\n\n5.A\nIndirect N2O emissions from the atmospheric deposition of nitrogen in NOx and NH3\n\n\n5.B\nFossil fuel fires\n\n\n\n\n\n\nSource: authors based on Crippa, et al. (2023).\nEDGAR datasets contain disaggregated information for the elements in the table above in Gigagrams for CO2, CO2 from biofuels, CH4, N2O, and Fluorinated greenhouse gases (F-Gases) PFC, HFC, HCFC, and NF3. However, while they provide a single dataset with aggregate GHG emissions expressed in CO2eq using the Global Warming Potential values of the Fifth Assessment Report of the IPCC, all gases are summed into a single figure for each element in Table 1, not distinguished from the individual shares of CO2 tons equivalent contributed by each gas. For that reason, we used the individualized datasets per gas in Gigagrams and performed the Global Warming Potential AR5 calculation ourselves using coefficients from Myhre et al. Myhre et al. (2013), except for F-Gases, for which the conversion was made by EDGAR and kept separate as needed.\n\n\n\nTable 2: Conversion coefficients for methane and nitrous oxide\n\n\n\n\n\n\n\n\n\nGas\nGlobal Warming Potential Values AR5 100-year horizon\n\n\n\n\nMethane (CH4)\n28 CO2 tons equivalent / Gigagram\n\n\nNitrous Oxide (N2O)\n265 CO2 tons equivalent / Gigagram\n\n\n\n\n\n\nSource: Myhre et al. (2013, 731).\nAs explained above, while the Edgar dataset is very comprehensive, it lacks the disaggregation by driver (intermediate input, output, endowment, or consumption) to satisfy the needs of CGE studies, when it comes to energy and certain agricultural aspects. That means that it is possible to identify to which volume of the IPCC a certain emission value belongs, but not which fuel product is responsible for it. For example, we can identify that CO2 emissions are emitted by the Road Transportation sector, but not whether the emissions come from the burning of Diesel or from Bioethanol or any other fuel type. For that reason, we replace the values related to energy with those from our own estimates using the United Nations Energy Database and default emission factors, as well as those elements related to agriculture and LULUCF with emissions data from FAOSTAT at the driver level (explained in the FAOSTAT section below). For completeness, the remaining domains; i.e. industrial processes, waste, and others are linked to total output of specific economic activities, using the International Standard Industrial Classification (United Nations, 2008) where possible (see Table 3).\n\n\n\nTable 3: Mapping from EDGAR to individual ISIC economic activities\n\n\n\n\n\n\n\n\n\n\n\nIPCC Code\nIPCC\nISIC Code\nISIC\n\n\n\n\n2.A.1\nCement production\n2394\nManufacture of cement, lime and plaster\n\n\n2.A.2\nLime production\n2394\nManufacture of cement, lime and plaster\n\n\n2.A.3\nGlass Production\n2310\nManufacture of glass and glass products\n\n\n2.A.4\nOther Process Uses of Carbonates\n9999\nUndetermined\n\n\n2.B\nChemical Industry\n2011\nManufacture of basic chemicals\n\n\n2.C\nMetal Industry\n2410\nManufacture of basic iron and steel\n\n\n2.D\nNon-Energy Products from Fuels and Solvent Use\n9999\nUndetermined\n\n\n2.E\nElectronics Industry\n2640\nManufacture of consumer electronics\n\n\n2.F\nProduct Uses as Substitutes for Ozone Depleting Substances\n9999\nUndetermined\n\n\n2.G\nOther Product Manufacture and Use\n9999\nUndetermined\n\n\n4.A\nSolid Waste Disposal\n3821\nTreatment and disposal of non-hazardous waste\n\n\n4.B\nBiological Treatment of Solid Waste\n3822\nTreatment and disposal of hazardous waste\n\n\n4.C\nIncineration and Open Burning of Waste\n3822\nTreatment and disposal of hazardous waste",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#emissions-from-agriculture-and-lulucf",
    "href": "documentation/methods/emissions_db_construction.html#emissions-from-agriculture-and-lulucf",
    "title": "MAFAP Emissions Database Construction",
    "section": "Emissions from Agriculture and LULUCF",
    "text": "Emissions from Agriculture and LULUCF\nData on CO2, CH4, and N2O emissions from Agriculture, Forestry, and Other Land Use, including Land Use Change were sourced from FAOSTAT3. The level of disaggregation of its individual datasets allows us to identify the driving agricultural product (crop) or endowment (animal assets or cropland area) behind the emission of a specific gas. Since values are expressed in kilotonnes (kt) of each GHG, we converted them to Global Warming Potential AR5 for a 100-year horizon using the values in Table 2. To facilitate the mapping to CGE and Input-Output frameworks, we added a correspondence to individual ISIC economic activities responsible for the emission, where possible.\nFAOSTAT datasets go beyond the elements stipulated in the third category of an IPCC inventory, and provide information on energy use by the agricultural sector, as well as emissions from industrial processes and waste. Since we source those from EDGAR for all economic sectors, we only use data from the domains shown in Table 4 from FAOSTAT.\n\n\n\n\nTable 4: FAOSTAT domains sourced\n\n\n\n\n\n\n\n\n\nCode\nSector\n\n\n\n\n3.B.1.a\nLULUCF - Forestland\n\n\n3.B.1.b\nLULUCF - Net Forest conversion\n\n\n3.B.2\nLULUCF - Drained organic soils (CO2)\n\n\n3.B.6.a\nLULUCF - Fires in organic soils\n\n\n3.B.6.b\nLULUCF - Forest fires\n\n\n3.C.1.c\nAgriculture - Savanna fires\n\n\n3.C.5\nAgriculture - Drained organic soils (N2O)\n\n\n3.A.1\nAgriculture - Enteric fermentation (Emissions CH4)\n\n\n3.A.2.a\nAgriculture - Emissions (N2O) (Manure applied)\n\n\n3.A.2.b\nAgriculture - Manure management (Emissions N2O)\n\n\n3.A.2.c\nAgriculture - Manure management (Emissions CH4)\n\n\n3.C.6\nAgriculture - Manure left on pasture (Emissions N2O)\n\n\n3.C.4\nAgriculture - Synthetic Fertilizers\n\n\n3.C.1.a\nAgriculture - Burning crop residues (Emissions CH4)\n\n\n3.C.1.b\nAgriculture - Burning crop residues (Emissions N2O)\n\n\n3.C.7\nAgriculture - Rice cultivation (Emissions CH4)\n\n\n3.C.8\nAgriculture - Crop residues (Emissions N2O)\n\n\n\n\n\n\n\n\n\n\nMore importantly, the reason why we replaced the data from EDGAR on agriculture emissions with FAOSTAT is because of the ability to differentiate the different drivers of those emissions, as well as the separate totals by gas. Table 5 shows the different elements from FAOSTAT available for practitioners to map to inputs, outputs, endowments, or consumption.\n\n\n\n\nTable 5: FAOSTAT domains sourced\n\n\n\n\n\n\n\n\n\nCode\nDriver\n\n\n\n\n0015\nWheat\n\n\n0027\nRice\n\n\n0044\nBarley\n\n\n0056\nMaize (corn)\n\n\n0071\nRye\n\n\n0075\nOats\n\n\n0079\nMillet\n\n\n0083\nSorghum\n\n\n0116\nPotatoes\n\n\n0156\nSugar cane\n\n\n0176\nBeans, dry\n\n\n0236\nSoya beans\n\n\n0946\nBuffalo\n\n\n0960\nCattle, dairy\n\n\n0961\nCattle, non-dairy\n\n\n0976\nSheep\n\n\n1016\nGoats\n\n\n1049\nSwine, market\n\n\n1051\nSwine, breeding\n\n\n1052\nChickens, layers\n\n\n1053\nChickens, broilers\n\n\n1068\nDucks\n\n\n1079\nTurkeys\n\n\n1096\nHorses\n\n\n1107\nAsses\n\n\n1110\nMules and hinnies\n\n\n1126\nCamels\n\n\n1177\nLlamas\n\n\n2012\nManufacture of fertilizers and nitrogen compounds\n\n\n9997\nUndetermined from LULUCF\n\n\n9998\nUndetermined from Agriculture",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#greenhouse-gas-emissions-from-stationary-and-mobile-combustion",
    "href": "documentation/methods/emissions_db_construction.html#greenhouse-gas-emissions-from-stationary-and-mobile-combustion",
    "title": "MAFAP Emissions Database Construction",
    "section": "Greenhouse Gas Emissions from Stationary and Mobile Combustion",
    "text": "Greenhouse Gas Emissions from Stationary and Mobile Combustion\nA choice was made to estimate emissions from combustion, although the global datasets that we use already have this information in the aggregate, because it was important to be able to distinguish between the different fuels driving the combustion and the sectors in which this happened. Greenhouse gas emissions from fuel combustion and fugitive emissions were estimated applying Tier 1 coefficients from the 2006 IPCC Guidelines for National Greenhouse Gas Inventories to national information on fuel uses from the United Nations Energy Database (UNSD 2023) using Equation 1. We first applied conversion factors from units of volume (metric tons) to Terajoules from Definitions, Units of Measure and Conversion Factors (United Nations 1987).\n\\[\nE_{GHG,fuel} =  C_{fuel} * F_{GHG, fuel}\n\\tag{1}\\]\nWhere:\n\n\\(E_{GHG,fuel}=\\) Emissions of a given GHG by type of fuel (kg GHG).\n\\(C_{fuel}=\\) Amount of fuel combusted (TJ).\n\\(F_{GHG, fuel}=\\) default emission factor of a given GHG by type of fuel (kg gas/TJ).\n\nThe UN dataset is organized according to the standard construction of Energy Balances and it features transactions related to supply, imports, stock variation, exports, transformation, industrial, and final use of all energy resources. In order to estimate emissions we focused on 39 energy resources subject to combustion or fugitive emissions (shown in Table 6) and 88 transactions.\n\n\n\n\nTable 6: Energy Commodities\n\n\n\n\n\n\n\n\n\nCommodity\n\n\n\n\nAnthracite\n\n\nAviation gasoline\n\n\nBagasse\n\n\nBio jet kerosene\n\n\nBiodiesel\n\n\nBiogases\n\n\nBiogasoline\n\n\nBlack liquor\n\n\nBlast furnace gas\n\n\nBrown coal\n\n\nBrown coal briquettes\n\n\nCharcoal\n\n\nCoal\n\n\nCoke oven gas\n\n\nCoke-oven coke\n\n\nCoking coal\n\n\nEthane\n\n\nFuel oil\n\n\nFuelwood\n\n\nGas coke\n\n\nGas oil/diesel oil\n\n\nGasoline-type jet fuel\n\n\nGasworks gas\n\n\nHard coal\n\n\nKerosene-type jet fuel\n\n\nLignite\n\n\nLignite brown coal\n\n\nLignite brown coal- recoverable resources\n\n\nLiquefied petroleum gas (lpg)\n\n\nMotor gasoline\n\n\nNaphtha\n\n\nNatural gas\n\n\nNatural gas (including lng)\n\n\nOther bituminous coal\n\n\nOther coal products\n\n\nOther hydrocarbons\n\n\nOther liquid biofuels\n\n\nPeat (for fuel use)\n\n\nPetroleum coke\n\n\nRefinery gas",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#database",
    "href": "documentation/methods/emissions_db_construction.html#database",
    "title": "MAFAP Emissions Database Construction",
    "section": "Database",
    "text": "Database",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#emissions",
    "href": "documentation/methods/emissions_db_construction.html#emissions",
    "title": "MAFAP Emissions Database Construction",
    "section": "Emissions",
    "text": "Emissions\nThe resulting database reports GHG emissions in million metric tonnes (mmt) and 100- year global warming potentials (GWPs) from the IPCC’s Fifth Assessment Reports (AR5). We provide two formats for practitioners’ convenience. A long format (what other efforts term “normalized”), where ISIC sectors are laid out in a single column, with a single column of values, and a pivot format, where ISIC sectors (including undetermined) are arranged in columns of data values. We provide a column named “Driver Category”, which can take the values “intermediate input”, “output”, “endowment”, “consumption”.",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/emissions_db_construction.html#footnotes",
    "href": "documentation/methods/emissions_db_construction.html#footnotes",
    "title": "MAFAP Emissions Database Construction",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nR was chosen for its information management and data compression facilities. However, the principles used can be easily implemented in Python, Stata, or any other language with similar affordances.↩︎\nThe data is available at: https://github.com/renatovargas/gears/tree/master/gears_db/data↩︎\nDatasets are available at https://www.fao.org/faostat/en/#data under the heading “Climate Change: Agrifood systems emissions”.↩︎",
    "crumbs": [
      "Documentation",
      "Methods",
      "Database peparation"
    ]
  },
  {
    "objectID": "documentation/methods/gears_processing.html",
    "href": "documentation/methods/gears_processing.html",
    "title": "GEARS database preparation",
    "section": "",
    "text": "In this session, we prepare a harmonized emissions dataset with inputs from FAOSTAT (FAO 2024) and EDGAR (Crippa et al. 2023). The objective is to have a single data lake from which we can extract data and make it compatible with any structure of economic activities.\n\n\n\n# Clean workspace\nrm(list = ls())\n\n# Load libraries\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(readxl)\nlibrary(openxlsx)\nlibrary(gt)\n# library(sf)\n# library(tmap)\n# library(raster)\n\n\n\n\nNote that some datasets have been converted to R rds files in a previous step for space considerations.\n\n\n\n# EDGAR\nedgar &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_AR5_GHG_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_co2 &lt;- read_xlsx(\n  \"gears_db/data/edgar/IEA_EDGAR_CO2_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_co2bio  &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_CO2bio_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_ch4 &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_CH4_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_n2o &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_N2O_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_f_gases &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_AR5g_F-gases_1990_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\n\n\n\n\n# FAOSTAT\nfaostat_total_emissions &lt;- \n  readRDS(\n    \"gears_db/data/faostat/total_emissions.rds\")\nfaostat_crops &lt;- \n  readRDS(\n    \"gears_db/data/faostat/crops.rds\")\nfaostat_drained_organic_soils &lt;- \n  readRDS(\n    \"gears_db/data/faostat/drained_organic_soils.rds\")\nfaostat_flags &lt;- \n  readRDS(\n    \"gears_db/data/faostat/flags.rds\")\nfaostat_livestock &lt;- \n  readRDS(\"gears_db/data/faostat/livestock.rds\")\nfaostat_production &lt;- \n  readRDS(\n    \"gears_db/data/faostat/production.rds\")\nfaostat_area_codes &lt;- \n  readRDS(\n    \"gears_db/data/faostat/area_codes.rds\")\n\n\n\n\n\nun_energy &lt;- readRDS(\n  \"gears_db/data/un_energy/un_energy.rds\"\n)\n\n\n\n\n\nfao_countries &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"FAOSTAT COUNTRIES\")\nfao_ipcc &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"FAOSTAT IPCC\")\nisic &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"GWP ISIC\")\nfull_isic4 &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"ISIC Rev 4\")\nun_energy_ipcc_coef &lt;- read_xlsx(\n  \"gears_db/data/coefficients/un_energy_ipcc_coefficients.xlsx\",\n  sheet = \"un_energy_coefficients\"\n)\n\n\n# Test to see units of measurement for each commodity\n# Fortunately no duplicates.\n# Use https://unstats.un.org/unsd/publication/SeriesF/SeriesF_44E.pdf\n# for conversions to TJ.\n# test &lt;- un_energy |&gt;\n#   group_by(Commodity, Unit) |&gt;\n#   summarize(Total = sum(Quantity, na.rm = T)) |&gt;\n#   ungroup()\n# write.table(test, \"clipboard\", sep = \"\\t\", row.names = F) # Windows\n# write.table(\n#   test, \n#   pipe(\"xclip -selection clipboard\"),  # Unix \n#   sep = \"\\t\", \n#   row.names = F)",
    "crumbs": [
      "Documentation",
      "Methods",
      "Processing code"
    ]
  },
  {
    "objectID": "documentation/methods/gears_processing.html#preliminaries",
    "href": "documentation/methods/gears_processing.html#preliminaries",
    "title": "GEARS database preparation",
    "section": "",
    "text": "# Clean workspace\nrm(list = ls())\n\n# Load libraries\nlibrary(tidyverse)\nlibrary(haven)\nlibrary(readxl)\nlibrary(openxlsx)\nlibrary(gt)\n# library(sf)\n# library(tmap)\n# library(raster)",
    "crumbs": [
      "Documentation",
      "Methods",
      "Processing code"
    ]
  },
  {
    "objectID": "documentation/methods/gears_processing.html#datasets",
    "href": "documentation/methods/gears_processing.html#datasets",
    "title": "GEARS database preparation",
    "section": "",
    "text": "Note that some datasets have been converted to R rds files in a previous step for space considerations.\n\n\n\n# EDGAR\nedgar &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_AR5_GHG_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_co2 &lt;- read_xlsx(\n  \"gears_db/data/edgar/IEA_EDGAR_CO2_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_co2bio  &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_CO2bio_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_ch4 &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_CH4_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_n2o &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_N2O_1970_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\nedgar_f_gases &lt;- read_xlsx(\n  \"gears_db/data/edgar/EDGAR_AR5g_F-gases_1990_2023.xlsx\",\n  skip = 9,\n  sheet = \"IPCC 2006\")\n\n\n\n\n\n# FAOSTAT\nfaostat_total_emissions &lt;- \n  readRDS(\n    \"gears_db/data/faostat/total_emissions.rds\")\nfaostat_crops &lt;- \n  readRDS(\n    \"gears_db/data/faostat/crops.rds\")\nfaostat_drained_organic_soils &lt;- \n  readRDS(\n    \"gears_db/data/faostat/drained_organic_soils.rds\")\nfaostat_flags &lt;- \n  readRDS(\n    \"gears_db/data/faostat/flags.rds\")\nfaostat_livestock &lt;- \n  readRDS(\"gears_db/data/faostat/livestock.rds\")\nfaostat_production &lt;- \n  readRDS(\n    \"gears_db/data/faostat/production.rds\")\nfaostat_area_codes &lt;- \n  readRDS(\n    \"gears_db/data/faostat/area_codes.rds\")\n\n\n\n\n\nun_energy &lt;- readRDS(\n  \"gears_db/data/un_energy/un_energy.rds\"\n)\n\n\n\n\n\nfao_countries &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"FAOSTAT COUNTRIES\")\nfao_ipcc &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"FAOSTAT IPCC\")\nisic &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"GWP ISIC\")\nfull_isic4 &lt;- read_xlsx(\n  \"gears_db/data/classifications/equivalence.xlsx\",\n  sheet = \"ISIC Rev 4\")\nun_energy_ipcc_coef &lt;- read_xlsx(\n  \"gears_db/data/coefficients/un_energy_ipcc_coefficients.xlsx\",\n  sheet = \"un_energy_coefficients\"\n)\n\n\n# Test to see units of measurement for each commodity\n# Fortunately no duplicates.\n# Use https://unstats.un.org/unsd/publication/SeriesF/SeriesF_44E.pdf\n# for conversions to TJ.\n# test &lt;- un_energy |&gt;\n#   group_by(Commodity, Unit) |&gt;\n#   summarize(Total = sum(Quantity, na.rm = T)) |&gt;\n#   ungroup()\n# write.table(test, \"clipboard\", sep = \"\\t\", row.names = F) # Windows\n# write.table(\n#   test, \n#   pipe(\"xclip -selection clipboard\"),  # Unix \n#   sep = \"\\t\", \n#   row.names = F)",
    "crumbs": [
      "Documentation",
      "Methods",
      "Processing code"
    ]
  },
  {
    "objectID": "documentation/methods/gears_processing.html#edgar-databases",
    "href": "documentation/methods/gears_processing.html#edgar-databases",
    "title": "GEARS database preparation",
    "section": "EDGAR databases",
    "text": "EDGAR databases\nThe first thing that we do with EDGAR is see which domains from IPCC it covers.\n\nedgar_ipcc_names &lt;- \n  data.frame(\n    code      = unique(\n      edgar$ipcc_code_2006_for_standard_report),\n    ipcc_name = unique(\n      edgar$ipcc_code_2006_for_standard_report_name)) |&gt; \n  arrange(code)\n\nedgar_ipcc_names |&gt; \n  gt()\n\n\n\n\n\n\n\ncode\nipcc_name\n\n\n\n\n1.A.1.a\nMain Activity Electricity and Heat Production\n\n\n1.A.1.bc\nPetroleum Refining - Manufacture of Solid Fuels and Other Energy Industries\n\n\n1.A.2\nManufacturing Industries and Construction\n\n\n1.A.3.a\nCivil Aviation\n\n\n1.A.3.b_noRES\nRoad Transportation no resuspension\n\n\n1.A.3.c\nRailways\n\n\n1.A.3.d\nWater-borne Navigation\n\n\n1.A.3.e\nOther Transportation\n\n\n1.A.4\nResidential and other sectors\n\n\n1.A.5\nNon-Specified\n\n\n1.B.1\nSolid Fuels\n\n\n1.B.2\nOil and Natural Gas\n\n\n2.A.1\nCement production\n\n\n2.A.2\nLime production\n\n\n2.A.3\nGlass Production\n\n\n2.A.4\nOther Process Uses of Carbonates\n\n\n2.B\nChemical Industry\n\n\n2.C\nMetal Industry\n\n\n2.D\nNon-Energy Products from Fuels and Solvent Use\n\n\n2.E\nElectronics Industry\n\n\n2.F\nProduct Uses as Substitutes for Ozone Depleting Substances\n\n\n2.G\nOther Product Manufacture and Use\n\n\n3.A.1\nEnteric Fermentation\n\n\n3.A.2\nManure Management\n\n\n3.C.1\nEmissions from biomass burning\n\n\n3.C.2\nLiming\n\n\n3.C.3\nUrea application\n\n\n3.C.4\nDirect N2O Emissions from managed soils\n\n\n3.C.5\nIndirect N2O Emissions from managed soils\n\n\n3.C.6\nIndirect N2O Emissions from manure management\n\n\n3.C.7\nRice cultivations\n\n\n4.A\nSolid Waste Disposal\n\n\n4.B\nBiological Treatment of Solid Waste\n\n\n4.C\nIncineration and Open Burning of Waste\n\n\n4.D\nWastewater Treatment and Discharge\n\n\n5.A\nIndirect N2O emissions from the atmospheric deposition of nitrogen in NOx and NH3\n\n\n5.B\nFossil fuel fires\n\n\n\n\n\n\n\nThe first thing that we see is that LULUCF is not included. We take note of this as we remove the domains that are covered in more detail in FAOSTAT (section 3). Originally, we estimated our own emissions for the energy part (section 1) from converting Energy Balances to the SEEA energy accounts format. However, this requires a Supply and Use table to distribute uses and applying TIER 1 coefficients. In this first version, we will take it as is from EDGAR.\nOur concern is that EDGAR takes use outside energy transformer industries from energy balance (i.e. other industrial, residential, transportation) at face value and we believe that this distribution can be improved if National Accounts is used to distribute intermediate and final consumption of energy outside the energy transformation sectors.\nWe could use total CO2 equivalent emissions aggregated from our edgar dataset, but full disaggregation by gas has been requested, so we perform our cleaning of the dataset for all of these and apply Tier 1 Global Warming Potential (GWP AR5) coefficients to individual datasets.\nBut first we use custom function transform_edgar_datasets to extract the relevant IPCC items and normalize the years structure.\n\n# Requires library(tidyverse)\n# Recursive function with direct naming of outputs\ntransform_edgar_datasets &lt;- function(datasets, dataset_names) {\n  if (length(datasets) == 0) {\n    return(invisible(NULL)) # End recursion\n  }\n  if(length(datasets)== 1){\n    print(\"The transformed datasets have the prefix 'transformed_'\")\n  }\n  # Process the first dataset\n  dataset &lt;- datasets[[1]]\n  name &lt;- dataset_names[[1]]\n  \n  # Apply the transformation\n  transformed &lt;- dataset |&gt; \n    filter(grepl(\"^(1|2|4|5)\", ipcc_code_2006_for_standard_report)) |&gt; \n    pivot_longer(\n      cols = starts_with(\"Y_\"),\n      names_to = \"Year\",\n      values_to= \"Value\"\n    ) |&gt; \n    mutate(\n      Year = as.numeric(sub(\"^Y_\", \"\", Year))\n    )\n  \n  # Assign the transformed dataset to the global environment\n  assign(paste0(\"transformed_\", name), transformed, envir = .GlobalEnv)\n  \n  # Recursion with the rest of the datasets\n  transform_edgar_datasets(datasets[-1], dataset_names[-1])\n}\n\n\nIndividual datasets\n\ndatasets &lt;- list(\n  edgar_co2,\n  edgar_co2bio,\n  edgar_ch4,\n  edgar_n2o,\n  edgar_f_gases\n)\ndataset_names &lt;- c(\"co2\", \"co2bio\", \"ch4\", \"n2o\", \"edgar_f_gases\")\n\ntransform_edgar_datasets(datasets, dataset_names)\n\n[1] \"The transformed datasets have the prefix 'transformed_'\"\n\nrm(datasets)\n\n\n\nDataset binding and GWP calculation\nWith the datasets transformed, we bind them together and transform to GWP.\n\n# Usage\ngwp_edgar_total &lt;- rbind(\n  transformed_co2,\n  transformed_co2bio,\n  transformed_ch4,\n  transformed_n2o,\n  transformed_edgar_f_gases) |&gt; \n  mutate(\n    Value = case_when(\n      Substance == \"CH4\" ~ Value * 28 , # GWP CH4 AR5 100-year horizon\n      Substance == \"N2O\" ~ Value * 265, # GWP N2O AR5 100-year horizon\n      .default = Value\n    ),\n    Substance = case_when(\n      Substance == \"CO2\" ~ \"Emissions (CO2)\",\n      Substance == \"CO2bio\" ~ \"Emissions (CO2bio)\",\n      Substance == \"CH4\" ~ \"Emissions (CO2eq) from CH4 (AR5)\",\n      Substance == \"N2O\" ~ \"Emissions (CO2eq) from N2O (AR5)\",\n      Substance == \"GWP_100_AR5_PFC\" ~\n        \"Emissions (CO2eq) from PFC (AR5)\",\n      Substance == \"GWP_100_AR5_HFC\" ~\n        \"Emissions (CO2eq) from HFC (AR5)\",\n      Substance == \"GWP_100_AR5_HCFC\" ~\n        \"Emissions (CO2eq) from HCFC (AR5)\",\n      Substance == \"GWP_100_AR5_SF6\" ~\n        \"Emissions (CO2eq) from SF6 (AR5)\",\n      Substance == \"GWP_100_AR5_NF3\" ~\n        \"Emissions (CO2eq) from NF3 (AR5)\",\n      .default = Substance\n    ),\n    `Element Code` = case_when(\n      Substance == \"Emissions (CO2)\" ~ 7273,\n      Substance == \"Emissions (CO2bio)\" ~ 7279,\n      Substance == \"Emissions (CO2eq) from CH4 (AR5)\"  ~ 724413,\n      Substance == \"Emissions (CO2eq) from N2O (AR5)\"  ~ 724313,\n      Substance == \"Emissions (CO2eq) from PFC (AR5)\"  ~ 724995,\n      Substance == \"Emissions (CO2eq) from HFC (AR5)\"  ~ 724996,\n      Substance == \"Emissions (CO2eq) from HCFC (AR5)\" ~ 724997,\n      Substance == \"Emissions (CO2eq) from SF6 (AR5)\"  ~ 724998,\n      Substance == \"Emissions (CO2eq) from NF3 (AR5)\"  ~ 724999,\n      .default = NA\n    ),\n    Unit = \"kt\",\n    `Driver Code` =\n      ipcc_code_2006_for_standard_report,\n    Driver = \n      ipcc_code_2006_for_standard_report_name,\n    `Sector Code` = ipcc_code_2006_for_standard_report,\n    Sector = ipcc_code_2006_for_standard_report_name,\n    Sector = if_else(\n      `Sector Code`== \"1.A.5\",\n      \"Non-Specified from IPCC Energy Volume\",\n      Sector),\n    # `Sector Code` = \"\",\n    # Sector = \"\"\n  ) |&gt; \n  mutate(across(where(is.character), as.factor)) |&gt; \n  rename(\n    Element = Substance,\n    ISO3 = Country_code_A3,\n    `IPCC Code` = ipcc_code_2006_for_standard_report,\n    IPCC = ipcc_code_2006_for_standard_report_name) |&gt; \n  left_join(\n    fao_countries,\n    join_by(ISO3)\n  ) |&gt; \n  select(\n    `Area Code`,\n    Area,\n    ISO3,\n    `Driver Code`,\n    Driver,\n    `Sector Code`,\n    Sector,\n    `Element Code`,\n    Element,\n    `IPCC Code`, \n    IPCC,\n    Year,\n    Unit,\n    Value )\n\n# Remove all EDGAR inputs\nrm(list = \n  ls()[startsWith(ls(), \"transformed_\") |\n         startsWith(ls(), \"edgar\")])\n\n# And save to RDS\nsaveRDS(gwp_edgar_total, \"gears_db/data/outputs/gwp_edgar_total.rds\")",
    "crumbs": [
      "Documentation",
      "Methods",
      "Processing code"
    ]
  },
  {
    "objectID": "documentation/methods/gears_processing.html#faostat-databases",
    "href": "documentation/methods/gears_processing.html#faostat-databases",
    "title": "GEARS database preparation",
    "section": "FAOSTAT databases",
    "text": "FAOSTAT databases\n\nTotal emissions\nNow we turn our attention to FAOSTAT. First we clean the totals dataset faostat_total_emissions.\n\n# For reference\nas.data.frame(rbind(\n  cbind(\"elements\", as.matrix(\n    unique(faostat_total_emissions$`Element Code`)\n  ), as.matrix(\n    unique(faostat_total_emissions$Element)\n  )),\n  cbind(\"items\", as.matrix(\n    unique(faostat_total_emissions$`Item Code`)\n  ), as.matrix(unique(\n    faostat_total_emissions$`Item`\n  )))\n)) |&gt;\n  gt()\n\n\n\n\n\n\n\nV1\nV2\nV3\n\n\n\n\nelements\n7234\nDirect emissions (N2O)\n\n\nelements\n7236\nIndirect emissions (N2O)\n\n\nelements\n7230\nEmissions (N2O)\n\n\nelements\n724313\nEmissions (CO2eq) from N2O (AR5)\n\n\nelements\n723113\nEmissions (CO2eq) (AR5)\n\n\nelements\n7225\nEmissions (CH4)\n\n\nelements\n724413\nEmissions (CO2eq) from CH4 (AR5)\n\n\nelements\n7273\nEmissions (CO2)\n\n\nelements\n717815\nEmissions (CO2eq) from F-gases (AR5)\n\n\nitems\n5064\nCrop Residues\n\n\nitems\n5060\nRice Cultivation\n\n\nitems\n5066\nBurning - Crop residues\n\n\nitems\n5058\nEnteric Fermentation\n\n\nitems\n5059\nManure Management\n\n\nitems\n5063\nManure left on Pasture\n\n\nitems\n5062\nManure applied to Soils\n\n\nitems\n5061\nSynthetic Fertilizers\n\n\nitems\n6729\nDrained organic soils\n\n\nitems\n67292\nDrained organic soils (CO2)\n\n\nitems\n67291\nDrained organic soils (N2O)\n\n\nitems\n6994\nOn-farm energy use\n\n\nitems\n6751\nForestland\n\n\nitems\n6750\nNet Forest conversion\n\n\nitems\n6795\nSavanna fires\n\n\nitems\n6993\nFires in organic soils\n\n\nitems\n6992\nForest fires\n\n\nitems\n69921\nFires in humid tropical forests\n\n\nitems\n6991\nAgrifood Systems Waste Disposal\n\n\nitems\n6504\nFertilizers Manufacturing\n\n\nitems\n6508\nFood Retail\n\n\nitems\n6505\nFood Household Consumption\n\n\nitems\n6815\nFood Transport\n\n\nitems\n6821\nEnergy\n\n\nitems\n6817\nIPPU\n\n\nitems\n6818\nWaste\n\n\nitems\n6819\nOther\n\n\nitems\n6518\nAgrifood systems\n\n\nitems\n6996\nFarm gate\n\n\nitems\n6516\nLand Use change\n\n\nitems\n6517\nPre- and Post- Production\n\n\nitems\n6995\nEmissions on agricultural land\n\n\nitems\n5084\nEmissions from crops\n\n\nitems\n5085\nEmissions from livestock\n\n\nitems\n1711\nIPCC Agriculture\n\n\nitems\n1709\nAgricultural Soils\n\n\nitems\n1707\nLULUCF\n\n\nitems\n6824\nAFOLU\n\n\nitems\n6825\nAll sectors with LULUCF\n\n\nitems\n6829\nAll sectors without LULUCF\n\n\nitems\n6997\nPesticides Manufacturing\n\n\nitems\n6507\nFood Processing\n\n\nitems\n6506\nFood Packaging\n\n\n\n\n\n\n\n\n# Filter elements of interest\ntransformed_faostat_total &lt;- faostat_total_emissions |&gt;\n  filter(\n    `Item Code` %in% c(\n      5061, 67292, \n      67291, 6751, 6750, \n      6795,  6993, 6992\n    ),\n    # `Item Code` %in% c(\n    #   5064,  5060, 5066, \n    #   5058,  5059, 5063, \n    #   5062,  5061, 67292, \n    #   67291, 6751, 6750, \n    #   6795,  6993, 6992\n    # ), \n    `Element Code` %in% c(\n      724313, 724413,\n      7273, 717815)\n    ) |&gt; \n  rename(\n    `Driver Code` = `Item Code`,\n    Driver = Item\n  ) |&gt; \n  mutate(\n    `Sector Code` = 9999,\n    Sector = \"Undetermined\",\n    Sector = case_when(\n      `Driver Code`== 5061 ~\n      \"Manufacture of fertilizers and nitrogen compounds\",\n      `Driver Code` %in% c(67291, 6795) ~\n        \"Undetermined from Agriculture\",\n      `Driver Code` %in% c(67292, 6750, 6751, 6992, 6993) ~\n        \"Undetermined from LULUCF\",\n      .default = Sector),\n    `Sector Code` = case_when(\n      `Driver Code`== 5061 ~\n      2012,\n      `Driver Code` %in% c(67291, 6795) ~\n        9998,\n      `Driver Code` %in% c(67292, 6750, 6751, 6992, 6993) ~\n        9997,\n      .default = `Sector Code`)\n  ) |&gt;\n  # Finally select in order to \n  # bind to livestock and crops\n  select(\n    `Area Code`,\n    Area,\n    `Driver Code`,\n    Driver,\n    `Sector Code`,\n    Sector,\n    `Element Code`,\n    Element,\n    Year,\n    Unit,\n    Value\n  )\n\nThen the resulting items:\n\n# For reference\nas.data.frame(rbind(\n  cbind(\"elements\", as.matrix(\n    unique(transformed_faostat_total$`Element Code`)\n  ), as.matrix(\n    unique(transformed_faostat_total$Element)\n  )),\n  cbind(\"Drivers\", as.matrix(\n    unique(transformed_faostat_total$`Driver Code`)\n  ), as.matrix(unique(\n    transformed_faostat_total$`Driver`\n  )))\n)) |&gt;\n  gt()\n\n\n\n\n\n\n\nV1\nV2\nV3\n\n\n\n\nelements\n724313\nEmissions (CO2eq) from N2O (AR5)\n\n\nelements\n7273\nEmissions (CO2)\n\n\nelements\n724413\nEmissions (CO2eq) from CH4 (AR5)\n\n\nDrivers\n5061\nSynthetic Fertilizers\n\n\nDrivers\n67292\nDrained organic soils (CO2)\n\n\nDrivers\n67291\nDrained organic soils (N2O)\n\n\nDrivers\n6751\nForestland\n\n\nDrivers\n6750\nNet Forest conversion\n\n\nDrivers\n6795\nSavanna fires\n\n\nDrivers\n6993\nFires in organic soils\n\n\nDrivers\n6992\nForest fires\n\n\n\n\n\n\n\nThen we move to the detailed datasets.\n\n\nCrops\n\n# For reference\nas.data.frame(rbind(\n  cbind(\"elements\", as.matrix(\n    unique(faostat_crops$`Element Code`)\n  ), as.matrix(\n    unique(faostat_crops$Element)\n  )),\n  cbind(\"items\", as.matrix(\n    unique(faostat_crops$`Item Code`)\n  ), as.matrix(unique(\n    faostat_crops$`Item`\n  )))\n)) |&gt;\n  gt()\n\n\n\n\n\n\n\nV1\nV2\nV3\n\n\n\n\nelements\n72392\nCrop residues (N content)\n\n\nelements\n72302\nCrop residues (Emissions N2O)\n\n\nelements\n72342\nCrop residues (Direct emissions N2O)\n\n\nelements\n72362\nCrop residues (Indirect emissions N2O)\n\n\nelements\n7245\nBurning crop residues (Biomass burned, dry matter)\n\n\nelements\n72307\nBurning crop residues (Emissions N2O)\n\n\nelements\n72257\nBurning crop residues (Emissions CH4)\n\n\nelements\n5312\nArea harvested\n\n\nelements\n72255\nRice cultivation (Emissions CH4)\n\n\nelements\n72430\nCrops total (Emissions N2O)\n\n\nelements\n72440\nCrops total (Emissions CH4)\n\n\nelements\n516202\nNitrogen fertilizer content applied that leaches\n\n\nelements\n516201\nNitrogen fertilizer content applied that volatilises\n\n\nelements\n5162\nSynthetic fertilizers (Agricultural use)\n\n\nelements\n72303\nSynthetic fertilizers (Emissions N2O)\n\n\nelements\n72343\nSynthetic fertilizers (Direct emissions N2O)\n\n\nelements\n723632\nIndirect emissions (N2O that leaches) (Synthetic fertilizers)\n\n\nelements\n723631\nIndirect emissions (N2O that volatilises) (Synthetic fertilizers)\n\n\nitems\n44\nBarley\n\n\nitems\n56\nMaize (corn)\n\n\nitems\n156\nSugar cane\n\n\nitems\n79\nMillet\n\n\nitems\n116\nPotatoes\n\n\nitems\n27\nRice\n\n\nitems\n15\nWheat\n\n\nitems\n1712\nAll Crops\n\n\nitems\n3102\nNutrient nitrogen N (total)\n\n\nitems\n176\nBeans, dry\n\n\nitems\n75\nOats\n\n\nitems\n71\nRye\n\n\nitems\n83\nSorghum\n\n\nitems\n236\nSoya beans\n\n\n\n\n\n\n\n\n# Filter elements of interest\ntransformed_faostat_crops &lt;- faostat_crops |&gt; \n  filter(\n    ! `Element Code` %in% c(\n      5312, 5162, 516201, 516202,\n      7245, 72303, 72430, 72440, \n      72342, 72343, 72362,\n      723631, 723632, 72392\n    ),\n    `Item Code` != 1712\n    # ! `Element Code` %in% c(\n    #   5162, 516201, 516202,\n    #   7245, 72430, 72440,\n    #   72342, 72362,\n    #   723631, 723632, 72392\n    # )\n    ) |&gt; \n  # Global Warming Potential\n  mutate(\n    Value = case_when(\n      `Element Code` %in% c(\n        72255, 72257\n      ) ~ Value * 28, # GWP CH4 AR5 100-year horizon\n      `Element Code` %in% c(\n        72302,72307\n      ) ~ Value * 265 # GWP N2O AR5 100-year horizon\n    )\n  ) |&gt; \n  mutate(\n    temp_code = case_when(\n      `Element Code` %in% c(\n        72255, 72257\n      ) ~ 724413,\n      `Element Code` %in% c(\n        72307, 72302\n      ) ~ 724313,\n      .default = NA\n    ),\n    temp = case_when(\n      `Element Code` %in% c(\n        72255, 72257\n      ) ~ \"Emissions (CO2eq) from CH4 (AR5)\",\n      `Element Code` %in% c(\n        72307, 72302\n      ) ~ \"Emissions (CO2eq) from N2O (AR5)\",\n      .default = NA\n    )\n  ) |&gt; \n  rename(\n    `Sector Code` = `Item Code`,\n    `Sector` = Item,\n    `Driver Code` = `Element Code`,\n    Driver = Element,\n    `Element Code`= temp_code,\n    Element = temp\n  )|&gt; \n  mutate(\n    `Sector Code` = sprintf(\"%04d\", `Sector Code`)\n  ) |&gt; \n  # Finally select in order to \n  # bind to livestock and crops\n  select(\n    `Area Code`,\n    Area,\n    `Driver Code`,\n    Driver,\n    `Sector Code`,\n    Sector,\n    `Element Code`,\n    Element,\n    Year,\n    Unit,\n    Value\n  )\n\nThe resulting items\n\n# For reference\nas.data.frame(rbind(\n  cbind(\"Sectors\", as.matrix(\n    unique(transformed_faostat_crops$`Sector Code`)\n  ), as.matrix(\n    unique(transformed_faostat_crops$Sector)\n  )),\n  cbind(\"Drivers\", as.matrix(\n    unique(transformed_faostat_crops$`Driver Code`)\n  ), as.matrix(unique(\n    transformed_faostat_crops$`Driver`\n  )))\n)) |&gt;\n  arrange(V1,V2) |&gt; \n  gt()\n\n\n\n\n\n\n\nV1\nV2\nV3\n\n\n\n\nDrivers\n72255\nRice cultivation (Emissions CH4)\n\n\nDrivers\n72257\nBurning crop residues (Emissions CH4)\n\n\nDrivers\n72302\nCrop residues (Emissions N2O)\n\n\nDrivers\n72307\nBurning crop residues (Emissions N2O)\n\n\nSectors\n0015\nWheat\n\n\nSectors\n0027\nRice\n\n\nSectors\n0044\nBarley\n\n\nSectors\n0056\nMaize (corn)\n\n\nSectors\n0071\nRye\n\n\nSectors\n0075\nOats\n\n\nSectors\n0079\nMillet\n\n\nSectors\n0083\nSorghum\n\n\nSectors\n0116\nPotatoes\n\n\nSectors\n0156\nSugar cane\n\n\nSectors\n0176\nBeans, dry\n\n\nSectors\n0236\nSoya beans\n\n\n\n\n\n\n\n\ntransformed_faostat_crops |&gt; \n  filter(\n    Year == 2018,\n    Area == \"Nigeria\"\n  ) |&gt; \n  group_by(\n    Driver,\n    Sector,\n    Unit\n  ) |&gt; \n  summarize(\n    Total = sum(Value, na.rm = T)\n  ) |&gt; \n  ungroup() |&gt; \n  gt()\n\n`summarise()` has grouped output by 'Driver', 'Sector'. You can override using\nthe `.groups` argument.\n\n\n\n\n\n\n\n\nDriver\nSector\nUnit\nTotal\n\n\n\n\nBurning crop residues (Emissions CH4)\nMaize (corn)\nkt\n494.5136\n\n\nBurning crop residues (Emissions CH4)\nRice\nkt\n169.0444\n\n\nBurning crop residues (Emissions CH4)\nSugar cane\nkt\n4.3456\n\n\nBurning crop residues (Emissions CH4)\nWheat\nkt\n1.5596\n\n\nBurning crop residues (Emissions N2O)\nMaize (corn)\nkt\n121.3435\n\n\nBurning crop residues (Emissions N2O)\nRice\nkt\n41.4725\n\n\nBurning crop residues (Emissions N2O)\nSugar cane\nkt\n1.0600\n\n\nBurning crop residues (Emissions N2O)\nWheat\nkt\n0.3710\n\n\nCrop residues (Emissions N2O)\nMaize (corn)\nkt\n556.6590\n\n\nCrop residues (Emissions N2O)\nMillet\nkt\n114.4005\n\n\nCrop residues (Emissions N2O)\nPotatoes\nkt\n41.6580\n\n\nCrop residues (Emissions N2O)\nRice\nkt\n825.1040\n\n\nCrop residues (Emissions N2O)\nSorghum\nkt\n537.7910\n\n\nCrop residues (Emissions N2O)\nSoya beans\nkt\n71.0465\n\n\nCrop residues (Emissions N2O)\nSugar cane\nkt\n0.0000\n\n\nCrop residues (Emissions N2O)\nWheat\nkt\n6.3070\n\n\nRice cultivation (Emissions CH4)\nRice\nkt\n12462.5760\n\n\n\n\n\n\n\n\n\nLivestock\n\n# Filter elements of interest\ntransformed_faostat_livestock &lt;- faostat_livestock |&gt; \n  filter(\n    ! `Element Code` %in% c(\n      72380,  72381, 72386, \n      723601, 723602, 723611, \n      723612, 723801, 723802, \n      723811, 723812, 72340, \n      72341, 72346, 72360, \n      72361, 72366, 72431,\n      72441\n    ),\n    ! `Item Code` %in% c(\n      1757, 1759, 1760,\n      1054, 2029, 1749,\n      1048, 1755\n    )) |&gt;\n  mutate(\n    Value = case_when(\n      `Element Code` %in% c(\n        72254, 72256\n      ) ~ Value * 28, # GWP CH4 AR5 100-year horizon\n      `Element Code` %in% c(\n        72300, 72301, 72306\n      ) ~ Value * 265, # GWP N2O AR5 100-year horizon\n      .default = Value\n    )\n  ) |&gt; \n  mutate(\n    temp_code = case_when(\n      `Element Code` %in% c(\n        72254, 72256\n      ) ~ 724413,\n      `Element Code` %in% c(\n        72300, 72301, 72306\n      ) ~ 724313,\n       `Element Code` == 5111 ~ 5111,\n      .default = NA\n    ),\n    temp = case_when(\n      `Element Code` %in% c(\n        72254, 72256\n      ) ~ \"Emissions (CO2eq) from CH4 (AR5)\",\n      `Element Code` %in% c(\n        72300, 72301, 72306\n      ) ~ \"Emissions (CO2eq) from N2O (AR5)\",\n      `Element Code` == 5111 ~ \"Number of animals\",\n      .default = NA\n    )\n  ) |&gt; \n  rename(\n    `Driver Code` = `Element Code`,\n    Driver = Element,\n    `Sector Code` = `Item Code`,\n    Sector = Item,\n    `Element Code`= temp_code,\n    Element = temp\n  )|&gt;\n  mutate(\n    `Sector Code` = sprintf(\"%04d\", `Sector Code`)\n  ) |&gt; \n  # Finally select in order to \n  # bind to livestock and crops\n  select(\n    `Area Code`,\n    Area,\n    `Driver Code`,\n    Driver,\n    `Sector Code`,\n    Sector,\n    `Element Code`,\n    Element,\n    Year,\n    Unit,\n    Value\n  )\n\nThe resulting items\n\n# For reference\nas.data.frame(rbind(\n  cbind(\"Drivers\", as.matrix(\n    unique(transformed_faostat_livestock$`Driver Code`)\n  ), as.matrix(\n    unique(transformed_faostat_livestock$Driver)\n  )),\n  cbind(\"Sectors\", as.matrix(\n    unique(transformed_faostat_livestock$`Sector Code`)\n  ), as.matrix(unique(\n    transformed_faostat_livestock$`Sector`\n  )))\n)) |&gt;\n  arrange(V1,V2) |&gt; \n  gt()\n\n\n\n\n\n\n\nV1\nV2\nV3\n\n\n\n\nDrivers\n5111\nStocks\n\n\nDrivers\n72254\nEnteric fermentation (Emissions CH4)\n\n\nDrivers\n72256\nManure management (Emissions CH4)\n\n\nDrivers\n72300\nManure left on pasture (Emissions N2O)\n\n\nDrivers\n72301\nEmissions (N2O) (Manure applied)\n\n\nDrivers\n72306\nManure management (Emissions N2O)\n\n\nSectors\n0946\nBuffalo\n\n\nSectors\n0960\nCattle, dairy\n\n\nSectors\n0961\nCattle, non-dairy\n\n\nSectors\n0976\nSheep\n\n\nSectors\n1016\nGoats\n\n\nSectors\n1049\nSwine, market\n\n\nSectors\n1051\nSwine, breeding\n\n\nSectors\n1052\nChickens, layers\n\n\nSectors\n1053\nChickens, broilers\n\n\nSectors\n1068\nDucks\n\n\nSectors\n1079\nTurkeys\n\n\nSectors\n1096\nHorses\n\n\nSectors\n1107\nAsses\n\n\nSectors\n1110\nMules and hinnies\n\n\nSectors\n1126\nCamels\n\n\nSectors\n1177\nLlamas\n\n\n\n\n\n\n\n\n\nDataset binding\n\ngwp_faostat_total &lt;- rbind(\n  transformed_faostat_total,\n  transformed_faostat_crops,\n  transformed_faostat_livestock) |&gt;\n  left_join(fao_countries[,c(1,3)], join_by(`Area Code`)) |&gt;\n  left_join(fao_ipcc, join_by(Driver)) |&gt; \n  filter(! is.na(ISO3)) |&gt; \n  relocate(`IPCC Code`, `IPCC`, .before = Year) |&gt; \n  relocate(ISO3, .before = `Driver Code`)\n  \n\n# And save to RDS\nsaveRDS(gwp_faostat_total, \"gears_db/data/outputs/gwp_faostat_total.rds\")\n\nobjects &lt;- c(\n  \"faostat_total_emissions\", \n  \"faostat_crops\", \n  \"faostat_livestock\")\n\n# Remove only variables if they exist\nrm(list = objects[objects %in% ls()])",
    "crumbs": [
      "Documentation",
      "Methods",
      "Processing code"
    ]
  }
]